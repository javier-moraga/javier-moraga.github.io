<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LATAM Airlines | Amelia GenAI Analytics</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&family=JetBrains+Mono:wght@400&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <script src="https://code.highcharts.com/highcharts.js"></script>
    <script src="https://code.highcharts.com/highcharts-more.js"></script>
    <script src="https://code.highcharts.com/modules/heatmap.js"></script>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        :root {
            /* Paleta Corporativa LATAM (Dark Mode) */
            --latam-indigo: #1B0088;
            --latam-red: #E30032;
            --latam-cyan: #00B5E2;
            --latam-grey: #8d9096;
            
            /* Fondos y Superficies */
            --bg-deep: #050510;
            --bg-gradient: linear-gradient(135deg, #0f0f1a 0%, #050510 100%);
            --card-bg: rgba(27, 0, 136, 0.05);
            --border-glass: rgba(255, 255, 255, 0.1);
            
            --text-white: #ffffff;
            --text-muted: #b0b0b0;
            --code-bg: #09090f;
        }

        * { box-sizing: border-box; }

        body {
            font-family: 'Inter', sans-serif;
            background: var(--bg-deep);
            background-image: var(--bg-gradient);
            color: var(--text-white);
            margin: 0;
            padding: 0;
            padding-top: 60px;
            padding-bottom: 60px;
            overflow-x: hidden; /* Prevenir scroll horizontal global */
        }

        /* --- NAV BAR --- */
        .nav-bar {
            padding: 10px 40px;
            display: flex; 
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid var(--border-glass);
            background: rgba(5, 5, 16, 0.95); 
            backdrop-filter: blur(10px);
            position: fixed; 
            width: 100%; 
            top: 0; 
            left: 0;
            z-index: 1000;
        }
        
        .back-link {
            text-decoration: none; 
            color: var(--text-muted); 
            font-size: 0.9rem;
            display: flex; 
            align-items: center; 
            gap: 8px; 
            transition: 0.3s;
        }
        
        .back-link:hover { color: var(--latam-red); transform: translateX(-5px); }
        .nav-name { font-weight: 700; color: white; }
        .nav-lang-container .lang-options { display: flex; gap: 10px; }

        .lang-btn {
            background: none; 
            border: 2px solid transparent; 
            border-radius: 50%; 
            cursor: pointer;
            padding: 0; 
            width: 30px; height: 30px;
            display: flex; align-items: center; justify-content: center;
            overflow: hidden;
            opacity: 0.5; 
            transition: 0.3s;
        }
        .lang-btn img { width: 100%; height: 100%; object-fit: cover; }
        .lang-btn:hover { opacity: 1; transform: scale(1.1); }
        .lang-btn.active { opacity: 1; border-color: var(--latam-red); box-shadow: 0 0 10px rgba(227, 0, 50, 0.4); transform: scale(1.15); }

        /* --- HEADER --- */
        header {
            padding: 40px 0 60px;
            text-align: center;
            border-bottom: 1px solid rgba(27, 0, 136, 0.3);
            background: radial-gradient(circle at center, rgba(27, 0, 136, 0.15), transparent 70%);
        }

        .brand-logo-header {
            max-width: 200px;
            height: auto;
            margin: 0 auto 30px auto;
            display: block;
            /* EFECTO NEÓN BLANCO */
            filter: drop-shadow(0 0 2px rgba(255, 255, 255, 0.8)) 
                    drop-shadow(0 0 8px rgba(255, 255, 255, 0.5)) 
                    drop-shadow(0 0 15px rgba(255, 255, 255, 0.2));
            transition: transform 0.3s ease, filter 0.3s ease;
        }
        .brand-logo-header:hover {
            transform: scale(1.05);
            filter: drop-shadow(0 0 2px rgba(255, 255, 255, 1)) 
                    drop-shadow(0 0 12px rgba(255, 255, 255, 0.8)) 
                    drop-shadow(0 0 25px rgba(255, 255, 255, 0.5));
        }

        .hero-badge {
            display: inline-block; 
            padding: 5px 15px; 
            background: rgba(0, 181, 226, 0.1); 
            border: 1px solid var(--latam-cyan);
            border-radius: 20px; 
            color: var(--latam-cyan); 
            font-size: 0.8rem; 
            font-weight: 600; 
            margin-bottom: 20px;
            letter-spacing: 1px;
        }

        h1 { font-size: 3rem; margin: 0 0 20px 0; letter-spacing: -1px; }
        .text-gradient {
            background: linear-gradient(90deg, #fff, var(--latam-cyan));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        .lead { color: var(--latam-grey); max-width: 800px; margin: 0 auto; font-size: 1.1rem; line-height: 1.6; }

        /* --- LAYOUT --- */
        .container { max-width: 1100px; margin: 0 auto; padding: 0 20px; }
        section { padding: 20px 0; }

        /* CORRECCIÓN 2: Overflow hidden en cards */
        .card {
            background: var(--card-bg);
            border: 1px solid var(--border-glass);
            backdrop-filter: blur(12px);
            border-radius: 16px;
            padding: 40px;
            margin-bottom: 24px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            overflow: hidden; /* Mantiene el contenido dentro de los bordes redondeados */
        }

        .section-label {
            color: var(--latam-red);
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1.5px;
            font-size: 0.85rem;
            margin-bottom: 15px;
            display: block;
        }

        .narrative-title {
            font-size: 2rem; margin-bottom: 20px; color: white;
            border-left: 4px solid var(--latam-indigo); padding-left: 20px;
        }
        .narrative-text { font-size: 1.1rem; color: var(--text-muted); line-height: 1.6; padding-left: 24px; }

        /* --- ARCHITECTURE --- */
        .arch-grid {
            display: flex; justify-content: space-between; align-items: center;
            margin: 40px 0; padding: 20px;
            background: rgba(0,0,0,0.2); border-radius: 12px; flex-wrap: wrap; gap: 20px;
        }
        .arch-step {
            flex: 1; text-align: center; background: rgba(255,255,255,0.03);
            padding: 15px; border-radius: 8px; border: 1px solid rgba(255,255,255,0.1); min-width: 120px;
        }
        .arch-label { font-size: 0.8rem; text-transform: uppercase; color: var(--latam-grey); margin-bottom: 0.5rem; }
        .arch-val { font-weight: 600; color: var(--latam-cyan); font-family: 'JetBrains Mono', monospace; font-size: 0.9rem;}
        .arrow { color: var(--latam-red); font-size: 1.5rem; font-weight: bold; }

        /* --- CHARTS --- */
        .chart-wrapper { 
            margin-bottom: 40px; 
            border-bottom: 1px solid var(--border-glass); 
            padding-bottom: 40px; 
            width: 100%; /* Asegura que no se expanda más allá del padre */
        }
        .chart-wrapper:last-child { border-bottom: none; }

        /* CORRECCIÓN 2: Grid Layout robusto */
        .micro-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            width: 100%;
        }
        @media (max-width: 900px) { .micro-grid { grid-template-columns: repeat(2, 1fr); } }
        @media (max-width: 600px) { .micro-grid { grid-template-columns: 1fr; } }

        .micro-card {
            background: rgba(0,0,0,0.2);
            border: 1px solid var(--border-glass);
            border-radius: 12px;
            padding: 20px;
            min-width: 0; /* CRÍTICO: Permite que el grid encoja los hijos si es necesario */
            overflow: hidden; /* Corta cualquier excedente del gráfico */
        }
        .micro-title {
            font-size: 0.9rem; font-weight: 600; color: var(--latam-cyan);
            margin-bottom: 15px; border-bottom: 1px solid rgba(255,255,255,0.05); padding-bottom: 10px;
            height: 40px; display: flex; align-items: center;
        }

        /* --- ACCORDION --- */
        .accordion-btn {
            background: rgba(255,255,255,0.03);
            border: 1px solid var(--border-glass);
            width: 100%; padding: 10px 15px;
            text-align: left; color: var(--latam-grey);
            cursor: pointer; font-family: 'Inter', sans-serif; font-size: 0.8rem;
            display: flex; justify-content: space-between; align-items: center;
            border-radius: 6px; margin-top: 10px; transition: all 0.3s;
        }
        .accordion-btn:hover { background: rgba(0, 181, 226, 0.1); color: var(--latam-cyan); }
        
        .code-panel {
            max-height: 0; overflow: hidden; transition: max-height 0.4s ease-out;
            background: var(--code-bg); border-radius: 0 0 6px 6px; margin-top: -2px;
        }
        .code-panel.active { max-height: 400px; border: 1px solid var(--border-glass); border-top: none; padding: 10px; }
        
        pre { margin: 0; padding: 1rem; overflow-x: auto; }
        code { font-family: 'JetBrains Mono', monospace; color: #a9b7c6; font-size: 0.7rem; }
        
        /* Syntax Highlight */
        .sql-kw { color: #cc7832; font-weight: bold; }
        .sql-str { color: #6a8759; }
        .sql-func { color: #ffc66d; }
        .sql-comm { color: #808080; font-style: italic; }

        /* --- CONTACT --- */
        .contact-section { text-align: center; margin-top: 60px; border-top: 1px solid var(--border-glass); padding-top: 40px; }
        .contact-btn {
            display: inline-block; padding: 15px 30px; background: var(--latam-red); color: white;
            border-radius: 30px; font-weight: 700; text-decoration: none;
            box-shadow: 0 10px 30px rgba(227, 0, 50, 0.3); transition: 0.3s;
        }
        .contact-btn:hover { transform: translateY(-3px); box-shadow: 0 15px 40px rgba(227, 0, 50, 0.5); }

    </style>
</head>
<body>

    <nav class="nav-bar">
        <a href="../index.html#projects" class="back-link">
            <i class="fas fa-arrow-left"></i> <span id="nav-back">Back to Portfolio</span>
        </a>

        <div class="nav-lang-container">
            <div class="lang-options">
                <button onclick="changeLang('en')" class="lang-btn" id="btn-en" title="English">
                    <img src="https://flagcdn.com/w80/gb.png" alt="English">
                </button>
                <button onclick="changeLang('es')" class="lang-btn active" id="btn-es" title="Español">
                    <img src="https://flagcdn.com/w80/es.png" alt="Español">
                </button>
            </div>
        </div>
        
        <div class="nav-name">Javier Moraga</div>
    </nav>

    <header>
        <div class="container">
            <img src="../logos/latam_airlines_chile.png" alt="LATAM Airlines" class="brand-logo-header">
            <span class="hero-badge" id="hero-badge">PROYECTO AMELIA</span>
            <h1 id="main-title">Inteligencia Artificial <br><span class="text-gradient">Corporativa</span></h1>
            <p class="lead" id="main-desc">Dashboard de adopción y rendimiento del modelo RAG (Retrieval-Augmented Generation) para LATAM Airlines. Análisis desde logs crudos hasta insights de RRHH.</p>
        </div>
    </header>

    <div class="container">

        <section>
            <div class="card">
                <span class="section-label" id="label-1">01. El Caso de Negocio</span>
                <h3 class="narrative-title" id="title-1">Más que un Chatbot: Conocimiento Contextual</h3>
                <div class="narrative-text" id="text-1">
                    <p>
                        A diferencia de los asistentes genéricos, <strong>Amelia</strong> fue entrenada con la estructura organizacional de LATAM (Capa Gold de Dataform). 
                        Cuando un tripulante pregunta <em>"¿Qué es una COBUS?"</em>, el sistema no alucina; consulta la normativa oficial indexada y responde con precisión.
                        Este dashboard monitorea la efectividad de esa recuperación de información.
                    </p>
                </div>
            </div>
        </section>

        <section>
            <div class="card">
                <span class="section-label" id="label-2">02. Arquitectura de Datos</span>
                <h3 class="narrative-title" id="title-2">Estructura del Pipeline (Dataform)</h3>
                <div class="arch-grid">
                    <div class="arch-step">
                        <div class="arch-label" id="arch-raw-label">Raw Layer</div>
                        <div class="arch-val">sources/logging_topic</div>
                    </div>
                    <div class="arrow">&#10132;</div>
                    <div class="arch-step">
                        <div class="arch-label" id="arch-silver-label">Silver Layer</div>
                        <div class="arch-val">staging/interaction_logs</div>
                    </div>
                    <div class="arrow">&#10132;</div>
                    <div class="arch-step">
                        <div class="arch-label" id="arch-gold-label">Gold Layer</div>
                        <div class="arch-val">reporting/interactions_full</div>
                    </div>
                </div>
            </div>
        </section>

        <section>
            <div class="card">
                <span class="section-label" id="label-3">03. Métricas Principales</span>
                
                <div class="chart-wrapper">
                    <h3 id="chart-title-1">Distribución de Interacciones por Producto</h3>
                    <div id="chart-products" style="height: 300px;"></div>
                    <button class="accordion-btn" onclick="toggleCode(this)">
                        <span><i class="fas fa-code"></i> <span class="query-label">Query</span>: interactions_ratios.sqlx</span>
                        <i class="fas fa-chevron-down"></i>
                    </button>
                    <div class="code-panel"><pre><code><span class="sql-comm">-- reporting/interactions_ratios.sqlx</span>
<span class="sql-kw">SELECT</span> product_name, <span class="sql-func">COUNT</span>(id) <span class="sql-kw">AS</span> interactions
<span class="sql-kw">FROM</span> `${ref("interactions_full")}`
<span class="sql-kw">GROUP BY</span> 1;</code></pre></div>
                </div>

                <div class="chart-wrapper">
                    <h3 id="chart-title-2">Penetración por Vicepresidencia (Top 5)</h3>
                    <div id="chart-vp" style="height: 300px;"></div>
                    <button class="accordion-btn" onclick="toggleCode(this)">
                        <span><i class="fas fa-code"></i> <span class="query-label">Query</span>: interaction_employees.sqlx</span>
                        <i class="fas fa-chevron-down"></i>
                    </button>
                    <div class="code-panel"><pre><code><span class="sql-comm">-- reporting/interaction_employees.sqlx</span>
<span class="sql-kw">SELECT</span> vp_level_2, adoption_rate
<span class="sql-kw">FROM</span> `${ref("current_staffing_rrhh")}`
<span class="sql-kw">ORDER BY</span> 2 <span class="sql-kw">DESC</span> <span class="sql-kw">LIMIT</span> 5;</code></pre></div>
                </div>

                <div class="chart-wrapper">
                    <h3 id="chart-title-3">Retención de Usuarios (Cohortes)</h3>
                    <div id="chart-cohorts" style="height: 400px;"></div>
                    <button class="accordion-btn" onclick="toggleCode(this)">
                        <span><i class="fas fa-code"></i> <span class="query-label">Query</span>: cohort_statistics.sqlx</span>
                        <i class="fas fa-chevron-down"></i>
                    </button>
                    <div class="code-panel"><pre><code><span class="sql-comm">-- reporting/cohort_statistics.sqlx</span>
<span class="sql-kw">SELECT</span> cohort_month, month_number, active_users
<span class="sql-kw">FROM</span> `${ref("retention_unique_users_cohort")}`;</code></pre></div>
                </div>

            </div>
        </section>

        <section>
            <div class="card">
                <span class="section-label" id="label-4">04. Métricas Operativas y Calidad</span>
                <h3 class="narrative-title" id="title-4">Detalle Operacional del Ecosistema</h3>
                
                <div class="micro-grid">
                    
                    <div class="micro-card">
                        <div class="micro-title" id="micro-title-1">Usuarios Únicos por Producto</div>
                        <div id="chart-users" style="height: 200px;"></div>
                        <button class="accordion-btn" onclick="toggleCode(this)">
                             <span class="query-label">Query</span>: ga4_general_daily_use.sqlx
                        </button>
                        <div class="code-panel"><pre><code><span class="sql-kw">SELECT</span> product, <span class="sql-func">COUNT</span>(DISTINCT user_id) 
<span class="sql-kw">FROM</span> `${ref("interaction_logs")}` 
<span class="sql-kw">GROUP BY</span> 1;</code></pre></div>
                    </div>

                    <div class="micro-card">
                        <div class="micro-title" id="micro-title-2">Interacciones Promedio / Usuario</div>
                        <div id="chart-intensity" style="height: 200px;"></div>
                        <button class="accordion-btn" onclick="toggleCode(this)">
                             <span class="query-label">Query</span>: products_user_avg.sqlx
                        </button>
                        <div class="code-panel"><pre><code><span class="sql-kw">SELECT</span> product, <span class="sql-func">AVG</span>(interactions_per_user) 
<span class="sql-kw">FROM</span> `${ref("products_user_avg")}`;</code></pre></div>
                    </div>

                    <div class="micro-card">
                        <div class="micro-title" id="micro-title-3">Ecosistema de Asistentes</div>
                        <div id="chart-assistants" style="height: 200px;"></div>
                        <button class="accordion-btn" onclick="toggleCode(this)">
                             <span class="query-label">Query</span>: user_activity.sqlx
                        </button>
                        <div class="code-panel"><pre><code><span class="sql-kw">SELECT</span> type, <span class="sql-func">COUNT</span>(assistant_id) 
<span class="sql-kw">FROM</span> `${ref("amelia_hub_activity")}` 
<span class="sql-kw">GROUP BY</span> 1;</code></pre></div>
                    </div>

                    <div class="micro-card">
                        <div class="micro-title" id="micro-title-4">Tasa de Errores (Mensual)</div>
                        <div id="chart-errors" style="height: 200px;"></div>
                        <button class="accordion-btn" onclick="toggleCode(this)">
                             <span class="query-label">Query</span>: products_error_rate.sqlx
                        </button>
                        <div class="code-panel"><pre><code><span class="sql-kw">SELECT</span> month, error_rate 
<span class="sql-kw">FROM</span> `${ref("products_error_rate")}` 
<span class="sql-kw">ORDER BY</span> 1;</code></pre></div>
                    </div>

                    <div class="micro-card">
                        <div class="micro-title" id="micro-title-5">Latencia de Respuesta (seg)</div>
                        <div id="chart-latency" style="height: 200px;"></div>
                        <button class="accordion-btn" onclick="toggleCode(this)">
                             <span class="query-label">Query</span>: ga4_session_times.sqlx
                        </button>
                        <div class="code-panel"><pre><code><span class="sql-kw">SELECT</span> product, <span class="sql-func">AVG</span>(response_time_sec) 
<span class="sql-kw">FROM</span> `${ref("ga4_session_times")}`;</code></pre></div>
                    </div>

                    <div class="micro-card">
                        <div class="micro-title" id="micro-title-6">Top Categorías de Contenido</div>
                        <div id="chart-content" style="height: 200px;"></div>
                        <button class="accordion-btn" onclick="toggleCode(this)">
                             <span class="query-label">Query</span>: interaction_content_sections.sqlx
                        </button>
                        <div class="code-panel"><pre><code><span class="sql-kw">SELECT</span> category, hits 
<span class="sql-kw">FROM</span> `${ref("ranking_words")}` 
<span class="sql-kw">LIMIT</span> 5;</code></pre></div>
                    </div>

                </div>
            </div>
        </section>

        <div class="contact-section">
            <p id="contact-text" style="color:var(--latam-grey); font-size:0.9rem; margin-bottom: 30px;">
                Este proyecto demuestra la capacidad de integrar Ingeniería de Datos (Dataform) con Inteligencia Artificial aplicada.
            </p>
            <a href="../index.html#contact" class="contact-btn" id="contact-btn-text">
                Contactar a Javier
            </a>
        </div>

    </div>

    <script>
        lucide.createIcons();
        function toggleCode(btn) {
            const panel = btn.nextElementSibling;
            panel.classList.toggle('active');
        }

        // --- TRADUCCIONES ---
        const translations = {
            es: {
                navBack: "Volver al Portafolio",
                badge: "PROYECTO AMELIA",
                title: "Inteligencia Artificial <br><span class='text-gradient'>Corporativa</span>",
                desc: "Dashboard de adopción y rendimiento del modelo RAG (Retrieval-Augmented Generation) para LATAM Airlines. Análisis desde logs crudos hasta insights de RRHH.",
                
                label1: "01. El Caso de Negocio",
                title1: "Más que un Chatbot: Conocimiento Contextual",
                text1: "<p>A diferencia de los asistentes genéricos, <strong>Amelia</strong> fue entrenada con la estructura organizacional de LATAM (Capa Gold de Dataform). Cuando un tripulante pregunta <em>'¿Qué es una COBUS?'</em>, el sistema no alucina; consulta la normativa oficial indexada y responde con precisión. Este dashboard monitorea la efectividad de esa recuperación de información.</p>",

                label2: "02. Arquitectura de Datos",
                title2: "Estructura del Pipeline (Dataform)",
                rawLayer: "Capa Raw",
                silverLayer: "Capa Silver",
                goldLayer: "Capa Gold",

                label3: "03. Métricas Principales",
                chart1: "Distribución de Interacciones por Producto",
                chart2: "Penetración por Vicepresidencia (Top 5)",
                chart3: "Retención de Usuarios (Cohortes)",
                
                label4: "04. Métricas Operativas y Calidad",
                title4: "Detalle Operacional del Ecosistema",
                
                micro1: "Usuarios Únicos por Producto",
                micro2: "Interacciones Promedio / Usuario",
                micro3: "Ecosistema de Asistentes",
                micro4: "Tasa de Errores (Mensual)",
                micro5: "Latencia de Respuesta (seg)",
                micro6: "Top Categorías de Contenido",

                queryLabel: "Consulta",
                contactText: "Este proyecto demuestra la capacidad de integrar Ingeniería de Datos (Dataform) con Inteligencia Artificial aplicada.",
                contactBtn: "Contactar a Javier",

                // Datos de gráficos (Strings en Español)
                chartsData: {
                    products: { name: "Interacciones", im: "Imágenes", libre: "Chat Libre" },
                    vp: { name: "Adopción" },
                    cohorts: { 
                        name: "Tasa de Retención", 
                        y: ['Sep 24', 'Oct 24', 'Nov 24', 'Dic 24', 'Ene 25', 'Feb 25', 'Mar 25', 'Abr 25', 'May 25'], 
                        x: ['Mes 0', 'Mes 1', 'Mes 2', 'Mes 3', 'Mes 4', 'Mes 5', 'Mes 6', 'Mes 7', 'Mes 8'],
                        tooltip: { join: "ingresó y en", ret: "retuvo al" }
                    },
                    users: { name: "Usuarios", x: ['RH+', 'Chat Libre', 'Imágenes'] },
                    intensity: { name: "Int/Usuario", x: ['Chat Libre', 'RH+', 'Imágenes'] },
                    assistants: { name: "Asistentes", int: "Internos", ext: "Externos" },
                    errors: { name: "% Error", x: ['Ene', 'Feb', 'Mar', 'Abr', 'May'] },
                    latency: { name: "Segundos", x: ['RH+ (RAG)', 'Chat Libre', 'Imágenes'] },
                    content: { name: "Consultas", x: ['COBUS', 'Beneficios', 'MyDuty', 'IT', 'Vacaciones'] }
                }
            },
            en: {
                navBack: "Back to Portfolio",
                badge: "AMELIA PROJECT",
                title: "Corporate <br><span class='text-gradient'>Artificial Intelligence</span>",
                desc: "Adoption and performance dashboard for the RAG (Retrieval-Augmented Generation) model at LATAM Airlines. Analysis from raw logs to HR insights.",
                
                label1: "01. Business Case",
                title1: "More than a Chatbot: Contextual Knowledge",
                text1: "<p>Unlike generic assistants, <strong>Amelia</strong> was trained with LATAM's organizational structure (Dataform Gold Layer). When a crew member asks <em>'What is a COBUS?'</em>, the system doesn't hallucinate; it queries indexed official regulations and responds precisely. This dashboard monitors the effectiveness of that information retrieval.</p>",

                label2: "02. Data Architecture",
                title2: "Pipeline Structure (Dataform)",
                rawLayer: "Raw Layer",
                silverLayer: "Silver Layer",
                goldLayer: "Gold Layer",

                label3: "03. Key Metrics",
                chart1: "Interactions Distribution by Product",
                chart2: "Penetration by VP (Top 5)",
                chart3: "User Retention (Cohorts)",
                
                label4: "04. Operational & Quality Metrics",
                title4: "Ecosystem Operational Detail",
                
                micro1: "Unique Users by Product",
                micro2: "Avg Interactions / User",
                micro3: "Assistant Ecosystem",
                micro4: "Error Rate (Monthly)",
                micro5: "Response Latency (sec)",
                micro6: "Top Content Categories",

                queryLabel: "Query",
                contactText: "This project demonstrates the ability to integrate Data Engineering (Dataform) with Applied AI.",
                contactBtn: "Contact Javier",

                // Charts Internal Data (Strings en Inglés)
                chartsData: {
                    products: { name: "Interactions", im: "Images", libre: "Free Chat" },
                    vp: { name: "Adoption" },
                    cohorts: { 
                        name: "Retention Rate", 
                        y: ['Sep 24', 'Oct 24', 'Nov 24', 'Dec 24', 'Jan 25', 'Feb 25', 'Mar 25', 'Apr 25', 'May 25'], 
                        x: ['Month 0', 'Month 1', 'Month 2', 'Month 3', 'Month 4', 'Month 5', 'Month 6', 'Month 7', 'Month 8'],
                        tooltip: { join: "joined and in", ret: "retained" }
                    },
                    users: { name: "Users", x: ['RH+', 'Free Chat', 'Images'] },
                    intensity: { name: "Int/User", x: ['Free Chat', 'RH+', 'Images'] },
                    assistants: { name: "Assistants", int: "Internal", ext: "External" },
                    errors: { name: "% Error", x: ['Jan', 'Feb', 'Mar', 'Apr', 'May'] },
                    latency: { name: "Seconds", x: ['RH+ (RAG)', 'Free Chat', 'Images'] },
                    content: { name: "Queries", x: ['COBUS', 'Benefits', 'MyDuty', 'IT', 'Vacations'] }
                }
            }
        };

        // --- VARIABLES GLOBALES PARA GRÁFICOS ---
        let cProducts, cVP, cCohorts, cUsers, cIntensity, cAssistants, cErrors, cLatency, cContent;

        function changeLang(lang) {
            document.querySelectorAll('.lang-btn').forEach(b => b.classList.remove('active'));
            document.getElementById('btn-' + lang).classList.add('active');
            const t = translations[lang];
            
            // DOM Elements Update
            document.getElementById('nav-back').textContent = t.navBack;
            document.getElementById('hero-badge').textContent = t.badge;
            document.getElementById('main-title').innerHTML = t.title;
            document.getElementById('main-desc').textContent = t.desc;
            
            document.getElementById('label-1').textContent = t.label1;
            document.getElementById('title-1').textContent = t.title1;
            document.getElementById('text-1').innerHTML = t.text1;

            document.getElementById('label-2').textContent = t.label2;
            document.getElementById('title-2').textContent = t.title2;
            document.getElementById('arch-raw-label').textContent = t.rawLayer;
            document.getElementById('arch-silver-label').textContent = t.silverLayer;
            document.getElementById('arch-gold-label').textContent = t.goldLayer;

            document.getElementById('label-3').textContent = t.label3;
            document.getElementById('chart-title-1').textContent = t.chart1;
            document.getElementById('chart-title-2').textContent = t.chart2;
            document.getElementById('chart-title-3').textContent = t.chart3;

            document.getElementById('label-4').textContent = t.label4;
            document.getElementById('title-4').textContent = t.title4;
            document.getElementById('micro-title-1').textContent = t.micro1;
            document.getElementById('micro-title-2').textContent = t.micro2;
            document.getElementById('micro-title-3').textContent = t.micro3;
            document.getElementById('micro-title-4').textContent = t.micro4;
            document.getElementById('micro-title-5').textContent = t.micro5;
            document.getElementById('micro-title-6').textContent = t.micro6;

            document.getElementById('contact-text').textContent = t.contactText;
            document.getElementById('contact-btn-text').textContent = t.contactBtn;

            document.querySelectorAll('.query-label').forEach(el => el.textContent = t.queryLabel);

            // --- CORRECCIÓN 1: ACTUALIZACIÓN DINÁMICA DE GRÁFICOS (INTERNA) ---
            
            if(cProducts) {
                // Actualiza nombre de serie y nombres de datos (ej: Chat Libre -> Free Chat)
                cProducts.series[0].update({ 
                    name: t.chartsData.products.name, 
                    data: [ 
                        {name: t.chartsData.products.libre, y:553000, color:'#1B0088'}, 
                        {name: 'RH+', y:179800, color:'#00B5E2'}, 
                        {name: t.chartsData.products.im, y:44500, color:'#E30032'} 
                    ] 
                });
            }
            
            if(cVP) cVP.series[0].update({ name: t.chartsData.vp.name });
            
            if(cCohorts) {
                // Actualiza título, Ejes y TOOLTIP
                cCohorts.update({
                    tooltip: {
                        formatter: function () {
                            return '<b>' + this.series.yAxis.categories[this.point.y] + '</b> ' + t.chartsData.cohorts.tooltip.join + ' <br><b>' +
                                this.series.xAxis.categories[this.point.x] + '</b> ' + t.chartsData.cohorts.tooltip.ret + ' <br><b>' + this.point.value + '%</b>';
                        }
                    }
                });
                cCohorts.series[0].update({ name: t.chartsData.cohorts.name });
                cCohorts.xAxis[0].setCategories(t.chartsData.cohorts.x);
                cCohorts.yAxis[0].setCategories(t.chartsData.cohorts.y);
            }

            if(cUsers) {
                cUsers.series[0].update({ name: t.chartsData.users.name });
                cUsers.xAxis[0].setCategories(t.chartsData.users.x);
            }
            if(cIntensity) {
                cIntensity.series[0].update({ name: t.chartsData.intensity.name });
                cIntensity.xAxis[0].setCategories(t.chartsData.intensity.x);
            }
            if(cAssistants) {
                cAssistants.series[0].update({ 
                    name: t.chartsData.assistants.name, 
                    data: [{name: t.chartsData.assistants.int, y:644}, {name: t.chartsData.assistants.ext, y:165}] 
                });
            }
            if(cErrors) {
                cErrors.series[0].update({ name: t.chartsData.errors.name });
                cErrors.xAxis[0].setCategories(t.chartsData.errors.x);
            }
            if(cLatency) {
                cLatency.series[0].update({ name: t.chartsData.latency.name });
                cLatency.xAxis[0].setCategories(t.chartsData.latency.x);
            }
            if(cContent) {
                cContent.series[0].update({ name: t.chartsData.content.name });
                cContent.xAxis[0].setCategories(t.chartsData.content.x);
            }
        }

        // --- HIGHCHARTS INIT ---
        Highcharts.setOptions({
            chart: { backgroundColor: 'transparent', style: { fontFamily: 'Inter' } },
            title: { text: null },
            credits: { enabled: false },
            colors: ['#1B0088', '#00B5E2', '#E30032', '#8d9096'],
            xAxis: { 
                gridLineColor: '#1f1f2e', lineColor: '#333',
                labels: { style: { color: '#8d9096', fontSize: '10px' } } 
            },
            yAxis: { 
                gridLineColor: '#1f1f2e', title: { text: null },
                labels: { style: { color: '#8d9096' } } 
            },
            legend: { enabled: false, itemStyle: { color: '#b0b0b0' } },
            plotOptions: { series: { animation: false } }
        });

        // 1. PRODUCTS
        cProducts = Highcharts.chart('chart-products', {
            chart: { type: 'pie' },
            plotOptions: { pie: { innerSize: '60%', borderWidth: 0, showInLegend: true } },
            series: [{ name: 'Interacciones', data: [ {name: 'Chat Libre', y:553000, color:'#1B0088'}, {name: 'RH+', y:179800, color:'#00B5E2'}, {name: 'Imágenes', y:44500, color:'#E30032'} ] }]
        });
        
        // 2. VP ADOPTION
        cVP = Highcharts.chart('chart-vp', {
            chart: { type: 'bar' },
            xAxis: { categories: ['VP Personas', 'VP Legal', 'VP IT', 'VP Clientes', 'VP Comercial'] },
            series: [{ name: 'Adopción', data: [88.7, 85.7, 83.3, 65.7, 60.9], color: '#1B0088' }]
        });

        // 3. COHORT HEATMAP (Actualizado: Sep 24 - May 25)
        cCohorts = Highcharts.chart('chart-cohorts', {
            chart: { type: 'heatmap', marginTop: 40, marginBottom: 80, plotBorderWidth: 1 },
            xAxis: { categories: ['Mes 0', 'Mes 1', 'Mes 2', 'Mes 3', 'Mes 4', 'Mes 5', 'Mes 6', 'Mes 7', 'Mes 8'] },
            yAxis: { 
                categories: ['Sep 24', 'Oct 24', 'Nov 24', 'Dic 24', 'Ene 25', 'Feb 25', 'Mar 25', 'Abr 25', 'May 25'], 
                title: null, 
                reversed: true 
            },
            colorAxis: {
                min: 0,
                max: 100,
                minColor: '#050510',
                maxColor: '#00B5E2'
            },
            legend: { enabled: true, align: 'right', layout: 'vertical', margin: 0, verticalAlign: 'top', y: 25, symbolHeight: 280 },
            tooltip: {
                formatter: function () {
                    // Texto por defecto (Español)
                    return '<b>' + this.series.yAxis.categories[this.point.y] + '</b> ingresó y en <br><b>' +
                        this.series.xAxis.categories[this.point.x] + '</b> retuvo al <br><b>' + this.point.value + '%</b> de usuarios';
                }
            },
            series: [{
                name: 'Tasa de Retención',
                borderWidth: 1,
                borderColor: '#1f1f2e',
                data: [
                    // Sep 24 Cohort (9 meses)
                    [0,0,100],[1,0,60],[2,0,50],[3,0,45],[4,0,42],[5,0,40],[6,0,39],[7,0,38],[8,0,38],
                    // Oct 24 Cohort (8 meses)
                    [0,1,100],[1,1,58],[2,1,48],[3,1,44],[4,1,41],[5,1,39],[6,1,38],[7,1,37],
                    // Nov 24 Cohort (7 meses)
                    [0,2,100],[1,2,55],[2,2,45],[3,2,42],[4,2,40],[5,2,38],[6,2,37],
                    // Dic 24 Cohort (6 meses)
                    [0,3,100],[1,3,50],[2,3,40],[3,3,38],[4,3,36],[5,3,35],
                    // Ene 25 Cohort (5 meses)
                    [0,4,100],[1,4,52],[2,4,42],[3,4,39],[4,4,37],
                    // Feb 25 Cohort (4 meses)
                    [0,5,100],[1,5,53],[2,5,43],[3,5,40],
                    // Mar 25 Cohort (3 meses)
                    [0,6,100],[1,6,54],[2,6,44],
                    // Abr 25 Cohort (2 meses)
                    [0,7,100],[1,7,55],
                    // May 25 Cohort (1 mes)
                    [0,8,100]
                ],
                dataLabels: { enabled: true, color: '#ffffff', style: { textOutline: 'none', fontSize: '9px' } }
            }]
        });

        // MICRO CHARTS
        cUsers = Highcharts.chart('chart-users', {
            chart: { type: 'column' },
            xAxis: { categories: ['RH+', 'Chat Libre', 'Imágenes'] },
            series: [{ name: 'Usuarios', data: [19146, 8914, 4637], color: '#00B5E2' }]
        });

        cIntensity = Highcharts.chart('chart-intensity', {
            chart: { type: 'bar' },
            xAxis: { categories: ['Chat Libre', 'RH+', 'Imágenes'] },
            series: [{ name: 'Int/Usuario', data: [62.0, 9.4, 9.6], color: '#1B0088' }]
        });

        cAssistants = Highcharts.chart('chart-assistants', {
            chart: { type: 'pie' },
            plotOptions: { pie: { innerSize: '0%', borderWidth: 0 } },
            series: [{ name: 'Asistentes', data: [{name: 'Internos', y:644}, {name: 'Externos', y:165}], colors: ['#E30032', '#8d9096'] }]
        });

        cErrors = Highcharts.chart('chart-errors', {
            chart: { type: 'line' },
            xAxis: { categories: ['Ene', 'Feb', 'Mar', 'Abr', 'May'] },
            yAxis: { max: 5 },
            series: [{ name: '% Error', data: [2.1, 1.8, 1.5, 1.2, 0.9], color: '#E30032' }]
        });

        cLatency = Highcharts.chart('chart-latency', {
            chart: { type: 'bar' },
            xAxis: { categories: ['RH+ (RAG)', 'Chat Libre', 'Imágenes'] },
            series: [{ name: 'Segundos', data: [1.2, 2.5, 4.1], color: '#8d9096' }]
        });

        cContent = Highcharts.chart('chart-content', {
            chart: { type: 'column' },
            xAxis: { categories: ['COBUS', 'Beneficios', 'MyDuty', 'IT', 'Vacaciones'] },
            series: [{ name: 'Consultas', data: [1540, 1200, 980, 850, 600], color: '#00B5E2' }]
        });

    </script>
<script>
    document.addEventListener("DOMContentLoaded", function() {
        // 1. LEER PARÁMETROS DE LA URL
        const params = new URLSearchParams(window.location.search);
        
        const mode = params.get('v');       // global
        const country = params.get('pais'); // cl
        const lang = params.get('lang') || 'en'; // es / en

        // 2. APLICAR TRADUCCIÓN INMEDIATA
        // Si la URL dice ?lang=es, cambiamos los textos ahora mismo
        if (typeof changeLang === 'function') {
            changeLang(lang);
        }

        // 3. CONFIGURAR EL BOTÓN VOLVER
        // Buscamos por clase .back-link (ya que no tienes id="btn-back")
        const backBtn = document.querySelector('.back-link');

        if (backBtn) {
            let returnUrl = "../index.html";
            let returnParams = [];

            // Reconstruimos los parámetros para no perder el modo (Chile/Global)
            if (mode) returnParams.push(`v=${mode}`);
            if (country) returnParams.push(`pais=${country}`);
            
            // Pasamos el idioma de vuelta al index
            if (lang) returnParams.push(`lang=${lang}`);

            // Si hay parámetros, los agregamos
            if (returnParams.length > 0) {
                returnUrl += "?" + returnParams.join("&");
            }
            
            // Agregamos el ancla para volver directo a la sección de proyectos
            returnUrl += "#projects";

            backBtn.href = returnUrl;
        }
    });
</script>
</body>
</html>