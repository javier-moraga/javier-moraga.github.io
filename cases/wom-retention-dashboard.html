<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Caso de Estudio: Gestión de Crisis & Analytics | WOM Portfolio</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700;800&family=Open+Sans:wght@300;400;600&family=Roboto+Mono:wght@400;500&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <script src="https://code.highcharts.com/highcharts.js"></script>
    <script src="https://code.highcharts.com/modules/accessibility.js"></script>

    <style>
        :root {
            --bg-deep: #120a1f; 
            --bg-gradient: linear-gradient(135deg, #1e0b2e 0%, #08040d 100%);
            --card-bg: rgba(30, 15, 45, 0.4);
            --primary-magenta: #E6007E;
            --secondary-cyan: #00C9FF;
            --accent-purple: #6a0dad;
            --accent-gold: #fbbf24;
            --text-white: #ffffff;
            --text-muted: #b0b0b0;
            --code-bg: #282a36;
            --success: #00e676;
            --border-light: rgba(255, 255, 255, 0.1);
            --wom-pink: #d946ef; /* Color neón principal */
        }

        * { box-sizing: border-box; }

        body {
            background: var(--bg-deep);
            background-image: var(--bg-gradient);
            color: var(--text-white);
            font-family: 'Open Sans', sans-serif;
            margin: 0;
            padding: 0;
            line-height: 1.6;
            overflow-x: hidden;
            padding-top: 60px;
            padding-bottom: 60px;
        }

        h1, h2, h3, h4 {
            font-family: 'Montserrat', sans-serif;
            margin-top: 0;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 0 20px;
        }

        /* --- NAV BAR MODIFICADA --- */
        .nav-bar {
            padding: 10px 40px; /* Reduje un poco el padding vertical para que las banderas encajen mejor */
            display: flex; 
            justify-content: space-between; /* Distribuye los 3 elementos: izq, centro, der */
            align-items: center;
            border-bottom: 1px solid rgba(255,255,255,0.05);
            background: rgba(11, 17, 32, 0.95); 
            backdrop-filter: blur(10px);
            position: fixed; 
            width: 100%; 
            top: 0; 
            left: 0;
            z-index: 1000; 
            box-sizing: border-box;
        }
        
        .back-link {
            text-decoration: none; 
            color: var(--text-muted); 
            font-size: 0.9rem;
            display: flex; 
            align-items: center; 
            gap: 8px; 
            transition: 0.3s;
            font-family: 'Inter', sans-serif;
        }
        
        .back-link:hover { 
            color: var(--wom-pink); 
            transform: translateX(-5px); 
        }

        .nav-name {
            font-weight: 700; 
            color: white;
            font-family: 'Inter', sans-serif;
        }

        /* Estilos para las banderas dentro del NAV */
        .nav-lang-container .lang-options {
            margin-bottom: 0; /* Eliminamos el margen que tenían en el header */
            display: flex;
            gap: 10px;
        }

        /* --- HEADER & LOGO NEÓN --- */
        header {
            padding: 40px 0 60px; /* Reduje un poco el padding superior */
            text-align: center;
            border-bottom: 1px solid rgba(230, 0, 126, 0.15);
            background: radial-gradient(circle at center, rgba(230, 0, 126, 0.1), transparent 70%);
        }

        .brand-logo-header {
            max-width: 150px; /* Un poco más grande para que se aprecie el neón */
            height: auto;
            margin: 0 auto 30px auto;
            display: block;
            /* CAMBIO: Efecto Neón Morado en lugar de blanco plano */
            filter: drop-shadow(0 0 2px var(--wom-pink)) 
                    drop-shadow(0 0 8px var(--wom-pink)) 
                    drop-shadow(0 0 15px rgba(217, 70, 239, 0.5));
            opacity: 1;
            transition: transform 0.3s ease, filter 0.3s ease;
        }
        
        .brand-logo-header:hover {
            transform: scale(1.05);
            /* Intensifica el neón al pasar el mouse */
            filter: drop-shadow(0 0 2px var(--wom-pink)) 
                    drop-shadow(0 0 12px var(--wom-pink)) 
                    drop-shadow(0 0 25px var(--wom-pink));
        }


        /* Estilos de botones de idioma (reutilizados en el nav) */
        .lang-btn {
            background: none; 
            border: 2px solid transparent; 
            border-radius: 50%; 
            cursor: pointer;
            padding: 0; 
            width: 30px; height: 30px; /* Ligeramente más pequeños para el nav */
            display: flex; align-items: center; justify-content: center;
            overflow: hidden;
            opacity: 0.5; 
            transition: 0.3s;
        }

        .lang-btn img { width: 100%; height: 100%; object-fit: cover; }
        .lang-btn:hover { opacity: 1; transform: scale(1.1); }
        .lang-btn.active { opacity: 1; border-color: var(--wom-pink); box-shadow: 0 0 10px rgba(217, 70, 239, 0.4); transform: scale(1.15); }


        /* --- RESTO DE ESTILOS --- */
        .hero-badge {
            display: inline-block; 
            padding: 5px 15px; 
            background: rgba(217, 70, 239, 0.1); 
            border: 1px solid var(--wom-pink);
            border-radius: 20px; 
            color: var(--wom-pink); 
            font-size: 0.8rem; 
            font-weight: 600; 
            margin-bottom: 20px;
            font-family: 'Inter', sans-serif;
            letter-spacing: 1px;
        }

        .kpi-badge {
            display: inline-block;
            background: rgba(0, 230, 118, 0.15);
            color: var(--success);
            border: 1px solid var(--success);
            padding: 10px 20px;
            border-radius: 50px;
            font-size: 0.9rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 25px;
            box-shadow: 0 0 15px rgba(0, 230, 118, 0.2);
        }

        header h1 {
            font-size: 3rem;
            font-weight: 800;
            line-height: 1.1;
            margin-bottom: 20px;
        }

        .text-gradient {
            background: linear-gradient(90deg, #fff, var(--primary-magenta));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        header p {
            font-size: 1.2rem;
            font-weight: 300;
            color: var(--text-muted);
            max-width: 800px;
            margin: 0 auto;
        }

        /* --- SECTIONS --- */
        section { padding: 20px 0; }

        .card {
            background: var(--card-bg);
            border: 1px solid var(--border-light);
            backdrop-filter: blur(12px);
            border-radius: 16px;
            padding: 40px;
            margin-bottom: 24px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.4);
            transition: transform 0.3s ease;
        }

        .section-label {
            color: var(--secondary-cyan);
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1.5px;
            font-size: 0.85rem;
            margin-bottom: 15px;
            display: block;
        }

        .narrative-title {
            font-size: 2rem;
            margin-bottom: 20px;
            color: white;
            border-left: 4px solid var(--primary-magenta);
            padding-left: 20px;
        }

        .narrative-text {
            font-size: 1.1rem;
            color: var(--text-muted);
            margin-bottom: 30px;
            padding-left: 24px;
        }

        .pipeline-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 40px 0;
            padding: 20px;
            background: rgba(0,0,0,0.2);
            border-radius: 12px;
            flex-wrap: wrap;
            gap: 20px;
        }

        .pipeline-step {
            flex: 1;
            text-align: center;
            background: rgba(255,255,255,0.05);
            padding: 15px;
            border-radius: 8px;
            border: 1px solid rgba(255,255,255,0.1);
            min-width: 120px;
        }

        .pipeline-step strong { display: block; color: var(--secondary-cyan); font-size: 1.1rem; }
        .pipeline-step span { font-size: 0.8rem; color: #888; }
        .arrow { color: var(--primary-magenta); font-size: 1.5rem; font-weight: bold; }

        .chart-container {
            width: 100%;
            height: 400px;
            border-radius: 8px;
            margin-bottom: 25px;
        }

        .code-block {
            display: none;
            margin-top: 15px;
            background: var(--code-bg);
            border-radius: 8px;
            border-left: 4px solid var(--primary-magenta);
            overflow: hidden;
            animation: fadeIn 0.4s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .code-header {
            background: #191a21;
            padding: 8px 15px;
            font-size: 0.75rem;
            color: #6272a4;
            font-family: 'Roboto Mono', monospace;
            border-bottom: 1px solid #333;
            display: flex;
            justify-content: space-between;
        }

        pre { margin: 0; padding: 20px; overflow-x: auto; }
        code { font-family: 'Roboto Mono', monospace; font-size: 0.85rem; color: #f8f8f2; }

        .sql-kw { color: #ff79c6; font-weight: bold; }
        .sql-func { color: #8be9fd; }
        .sql-str { color: #f1fa8c; }
        .sql-comm { color: #6272a4; font-style: italic; }
        .sql-num { color: #bd93f9; }

        .competitor-alert {
            background: rgba(230, 0, 126, 0.1);
            border-left: 4px solid var(--primary-magenta);
            padding: 15px;
            margin: 20px 0;
            border-radius: 4px;
            font-size: 0.95rem;
        }

        .accordion { margin-top: 30px; }
        .accordion-item { border-bottom: 1px solid var(--border-light); margin-bottom: 10px; }

        .accordion-header {
            width: 100%;
            background: none;
            border: none;
            color: var(--text-white);
            padding: 20px;
            text-align: left;
            font-family: 'Montserrat', sans-serif;
            font-size: 1rem;
            font-weight: 700;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: background 0.3s;
        }

        .accordion-header:hover { background: rgba(255, 255, 255, 0.05); }
        .accordion-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.4s ease-out;
            padding: 0 20px;
        }

        .accordion-item.active .accordion-content {
            max-height: 2500px;
            padding-bottom: 20px;
        }

        .accordion-item.active .icon { transform: rotate(45deg); color: var(--primary-magenta); }
        .icon { font-size: 1.5rem; transition: transform 0.3s; color: var(--secondary-cyan); }

        /* CONTACT SECTION */
        .contact-section {
            text-align: center; 
            margin-top: 80px; 
            border-top: 1px solid rgba(255,255,255,0.1); 
            padding-top: 40px;
        }

        .contact-btn {
            display: inline-block; 
            padding: 15px 30px; 
            background: var(--wom-pink); 
            color: white; 
            border-radius: 30px; 
            font-weight: 700; 
            text-decoration: none; 
            box-shadow: 0 10px 30px rgba(217, 70, 239, 0.3); 
            transition: 0.3s;
            font-family: 'Inter', sans-serif;
        }

        .contact-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 40px rgba(217, 70, 239, 0.5);
            color: white;
        }

        @media (max-width: 768px) {
            header h1 { font-size: 2.2rem; }
            .card { padding: 20px; }
            .pipeline-container { flex-direction: column; }
            .arrow { transform: rotate(90deg); }
            /* Ajuste para el nav en móviles */
            .nav-name { display: none; } /* Ocultar nombre en móvil si falta espacio */
        }
    </style>
</head>
<body>

    <nav class="nav-bar">
        <a href="../index.html#projects" class="back-link">
            <i class="fa-solid fa-arrow-left"></i> Back to Portfolio
        </a>

        <div class="nav-lang-container">
            <div class="lang-options">
                <button onclick="changeLang('en')" class="lang-btn" id="btn-en" title="English">
                    <img src="https://flagcdn.com/w80/gb.png" alt="English">
                </button>
                <button onclick="changeLang('es')" class="lang-btn active" id="btn-es" title="Español">
                    <img src="https://flagcdn.com/w80/es.png" alt="Español">
                </button>
            </div>
        </div>
        
        <div class="nav-name">Javier Moraga</div>
    </nav>

    <header>
        <div class="container">
            <img src="../logos/wom_chile.png" alt="WOM Chile" class="brand-logo-header">

            <span class="hero-badge">MARKETING INTELLIGENCE</span>

            <div class="kpi-badge" id="header-badge">Impacto: Contención de Fuga (Share Out salvado en 20.8% vs 23.8% proyectado)</div>
            <h1 id="header-title">Mitigación de Crisis &<br><span class="text-gradient">Análisis de Datos</span></h1>
            <h2 id="header-subtitle">Caso Mayo 2022</h2>
            <p id="header-desc">Reporte de inteligencia de datos para el Grupo Novator tras incidente crítico de red.</p>
        </div>
    </header>

    <div class="container">

        <section>
            <div class="card">
                <span class="section-label" id="label-1">01. Contexto & Gobernanza</span>
                <h3 class="narrative-title" id="title-1">La "Fuente de la Verdad" Corporativa</h3>
                <div class="narrative-text" id="text-1">
                    <p>Lideré la unificación de cifras entre Postpago y Business. Mi código SQL actuó como la 'Fuente de la Verdad' para justificar desviaciones presupuestarias ante el CEO.</p>
                </div>
            </div>
        </section>

        <section>
            <div class="card">
                <span class="section-label" id="label-2">02. Arquitectura de Datos</span>
                <h3 class="narrative-title" id="title-2">Pipeline de Respuesta Rápida</h3>
                <div class="pipeline-container">
                    <div class="pipeline-step"><strong id="step-raw">RAW</strong><span id="step-raw-desc">Logs de Red</span></div>
                    <div class="arrow">&#10132;</div>
                    <div class="pipeline-step"><strong id="step-silver">SILVER</strong><span id="step-silver-desc">Negocio</span></div>
                    <div class="arrow">&#10132;</div>
                    <div class="pipeline-step"><strong id="step-gold">GOLD</strong><span id="step-gold-desc">KPIs Finales</span></div>
                    <div class="arrow">&#10132;</div>
                    <div class="pipeline-step" style="border-color: var(--success);">
                        <strong style="color: var(--success);">DASHBOARD</strong><span id="step-dash-desc">Looker Studio</span>
                    </div>
                </div>
            </div>
        </section>

        <section>
            <div class="card" style="border-top: 4px solid var(--secondary-cyan);">
                <span class="section-label" id="label-3">Advanced Engineering</span>
                <h3 class="narrative-title" id="title-3">Technical Deep Dive & Business Impact</h3>
                
                <div class="competitor-alert" id="alert-text">
                    <strong>⚠️ Urgencia:</strong> Ataque de Movistar elevó consultas NPG un <strong>+4.9%</strong>.
                </div>

                <div class="accordion">
                    <div class="accordion-item">
                        <button class="accordion-header" onclick="toggleAccordion(this)">
                            <span id="acc-title-1">01. Ingeniería de Escala: Optimización BigQuery</span>
                            <span class="icon">+</span>
                        </button>
                        <div class="accordion-content">
                            <p id="acc-desc-1">DDL con Partitioning y Clustering para eficiencia de costos en logs masivos.</p>
                            <div class="code-block" style="display:block;">
                                <div class="code-header">BigQuery SQL</div>
                                <pre><code id="code-1"><span class="sql-comm">-- Optimización de partición y clustering</span>
<span class="sql-kw">CREATE OR REPLACE TABLE</span> `gold.falla_red_momento_cero`
<span class="sql-kw">PARTITION BY</span> <span class="sql-func">DATE</span>(fecha_incidencia)
<span class="sql-kw">CLUSTER BY</span> customer_id <span class="sql-kw">AS</span>
<span class="sql-kw">WITH</span> RankedLogs <span class="sql-kw">AS</span> (
  <span class="sql-kw">SELECT</span> *, <span class="sql-func">ROW_NUMBER</span>() <span class="sql-kw">OVER</span>(<span class="sql-kw">PARTITION BY</span> customer_id <span class="sql-kw">ORDER BY</span> timestamp) <span class="sql-kw">AS</span> rank_e
  <span class="sql-kw">FROM</span> `raw.network_logs` <span class="sql-kw">WHERE</span> status = <span class="sql-str">'FAIL'</span>
)
<span class="sql-kw">SELECT</span> * <span class="sql-kw">FROM</span> RankedLogs <span class="sql-kw">WHERE</span> rank_e = <span class="sql-num">1</span>;</code></pre>
                            </div>
                        </div>
                    </div>

                    <div class="accordion-item">
                        <button class="accordion-header" onclick="toggleAccordion(this)">
                            <span id="acc-title-2">02. Lógica de Priorización: Scoring en Python</span>
                            <span class="icon">+</span>
                        </button>
                        <div class="accordion-content">
                            <p id="acc-desc-2">Scoring preventivo para blindaje de base crítica (Score = Fuga * ARPU).</p>
                            <div class="code-block" style="display:block;">
                                <div class="code-header">Python / Pandas</div>
                                <pre><code id="code-2"><span class="sql-kw">def</span> <span class="sql-func">asignar_blindaje</span>(df):
    <span class="sql-comm"># Calcular Score de Riesgo</span>
    df[<span class="sql-str">'score'</span>] = df[<span class="sql-str">'prob_fuga'</span>] * df[<span class="sql-str">'arpu'</span>]
    top_target = df.nlargest(<span class="sql-num">240000</span>, <span class="sql-str">'score'</span>)
    <span class="sql-comm"># Lógica de asignación de beneficio</span>
    top_target[<span class="sql-str">'action'</span>] = top_target[<span class="sql-str">'is_legacy'</span>].apply(<span class="sql-kw">lambda</span> x: <span class="sql-str">'RECAMBIO'</span> <span class="sql-kw">if</span> x <span class="sql-kw">else</span> <span class="sql-str">'100GB'</span>)
    <span class="sql-kw">return</span> top_target</code></pre>
                            </div>
                        </div>
                    </div>

                    <div class="accordion-item">
                        <button class="accordion-header" onclick="toggleAccordion(this)">
                            <span id="acc-title-3">03. Dashboarding: SQL para Looker Studio</span>
                            <span class="icon">+</span>
                        </button>
                        <div class="accordion-content">
                            <p id="acc-desc-3">Queries para conectar BigQuery a Looker Studio y automatizar indicadores de crisis.</p>
                            
                            <div class="code-block" style="display:block;">
                                <div class="code-header" id="code-h-3a">BQ SQL | Looker: Share Out</div>
                                <pre><code><span class="sql-kw">SELECT</span> 
  <span class="sql-func">FORMAT_DATE</span>(<span class="sql-str">'%b'</span>, FECHA_PORT_OUT) <span class="sql-kw">AS</span> Mes,
  OPERADOR_DESTINO,
  <span class="sql-func">COUNT</span>(*) / <span class="sql-func">SUM</span>(<span class="sql-func">COUNT</span>(*)) <span class="sql-kw">OVER</span>(<span class="sql-kw">PARTITION BY</span> <span class="sql-func">LAST_DAY</span>(FECHA_PORT_OUT)) <span class="sql-kw">AS</span> pct_share
<span class="sql-kw">FROM</span> `gold.tr_portabilidad`
<span class="sql-kw">GROUP BY</span> <span class="sql-num">1</span>, <span class="sql-num">2</span>;</code></pre>
                            </div>

                            <div class="code-block" style="display:block; margin-top:10px;">
                                <div class="code-header" id="code-h-3b">BQ SQL | Looker: Red vs Lag Time</div>
                                <pre><code><span class="sql-kw">SELECT</span> 
  <span class="sql-func">EXTRACT</span>(WEEK <span class="sql-kw">FROM</span> FECHA_INCIDENCIA) <span class="sql-kw">AS</span> Semana,
  <span class="sql-func">COUNT</span>(DISTINCT ID_INCIDENCIA) <span class="sql-kw">AS</span> total_incidentes,
  <span class="sql-func">AVG</span>(DIAS_HASTA_FUGA) <span class="sql-kw">AS</span> avg_lag_time
<span class="sql-kw">FROM</span> `gold.analytics_incidentes`
<span class="sql-kw">GROUP BY</span> <span class="sql-num">1</span>;</code></pre>
                            </div>

                            <div class="code-block" style="display:block; margin-top:10px;">
                                <div class="code-header" id="code-h-3c">BQ SQL | Looker: ROI Retención</div>
                                <pre><code><span class="sql-kw">SELECT</span> 
  Mes,
  <span class="sql-func">SUM</span>(CASE WHEN estado_cliente = <span class="sql-str">'ACTIVO'</span> THEN 1 ELSE 0 END) <span class="sql-kw">AS</span> retenidos,
  <span class="sql-func">SUM</span>(costo_oferta) <span class="sql-kw">AS</span> inversion_total
<span class="sql-kw">FROM</span> `gold.reporting_retencion`
<span class="sql-kw">GROUP BY</span> <span class="sql-num">1</span>;</code></pre>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section>
            <div class="card">
                <span class="section-label" id="label-4">04. Visualización de Resultados</span>
                <div id="chart-competencia" class="chart-container"></div>
                <div id="chart-diagnostico" class="chart-container"></div>
                <div id="chart-respuesta" class="chart-container"></div>
            </div>
        </section>

        <div class="contact-section">
            <p id="contact-text" style="color:#94a3b8; font-size:0.9rem; margin-bottom: 30px;">
                Este caso demuestra la capacidad de manejar métricas sensibles de negocio y presentarlas a Ejecutivos C-Level.
            </p>
            <a href="../index.html#contact" class="contact-btn" id="contact-btn-text">
                Contactar a Javier
            </a>
        </div>

    </div>

    <script>
        function toggleAccordion(element) {
            element.parentElement.classList.toggle('active');
        }

        // --- SISTEMA DE TRADUCCIÓN ---
        const translations = {
            es: {
                badge: "Impacto: Contención de Fuga (Share Out salvado en 20.8% vs 23.8% proyectado)",
                h1: "Mitigación de Crisis &<br><span class='text-gradient'>Análisis de Datos</span>",
                subtitle: "Caso Mayo 2022",
                desc: "Reporte de inteligencia de datos para el Grupo Novator tras incidente crítico de red.",
                
                label1: "01. Contexto & Gobernanza",
                title1: "La \"Fuente de la Verdad\" Corporativa",
                text1: "<p>Lideré la unificación de cifras entre Postpago y Business. Mi código SQL actuó como la 'Fuente de la Verdad' para justificar desviaciones presupuestarias ante el CEO.</p>",
                
                label2: "02. Arquitectura de Datos",
                title2: "Pipeline de Respuesta Rápida",
                steps: { raw: "Logs de Red", silver: "Negocio", gold: "KPIs Finales", dash: "Looker Studio" },

                label3: "Ingeniería Avanzada",
                title3: "Deep Dive Técnico e Impacto",
                alert: "<strong>⚠️ Urgencia:</strong> Ataque de Movistar elevó consultas NPG un <strong>+4.9%</strong>.",

                acc1: { t: "01. Ingeniería de Escala: Optimización BigQuery", d: "DDL con Partitioning y Clustering para eficiencia de costos en logs masivos.", code_comm: "-- Optimización de partición y clustering" },
                acc2: { t: "02. Lógica de Priorización: Scoring en Python", d: "Scoring preventivo para blindaje de base crítica (Score = Fuga * ARPU).", code_comm1: "# Calcular Score de Riesgo", code_comm2: "# Lógica de asignación de beneficio" },
                acc3: { t: "03. Dashboarding: SQL para Looker Studio", d: "Queries para conectar BigQuery a Looker Studio y automatizar indicadores de crisis.", h3a: "BQ SQL | Looker: Share Out", h3b: "BQ SQL | Looker: Red vs Lag Time", h3c: "BQ SQL | Looker: ROI Retención" },

                label4: "04. Visualización de Resultados",
                contactText: "Este caso demuestra la capacidad de manejar métricas sensibles de negocio y presentarlas a Ejecutivos C-Level.",
                contactBtn: "Contactar a Javier"
            },
            en: {
                badge: "Impact: Churn Containment (Share Out saved at 20.8% vs 23.8% forecast)",
                h1: "Crisis Mitigation &<br><span class='text-gradient'>Data Analytics</span>",
                subtitle: "Case May 2022",
                desc: "Data intelligence report for Novator Group following a critical network incident.",
                
                label1: "01. Context & Governance",
                title1: "The Corporate \"Source of Truth\"",
                text1: "<p>I led the unification of figures between Postpaid and Business units. My SQL code served as the 'Source of Truth' to justify budget deviations to the CEO.</p>",
                
                label2: "02. Data Architecture",
                title2: "Rapid Response Pipeline",
                steps: { raw: "Network Logs", silver: "Business Logic", gold: "Final KPIs", dash: "Looker Studio" },

                label3: "Advanced Engineering",
                title3: "Technical Deep Dive & Business Impact",
                alert: "<strong>⚠️ Urgency:</strong> Competitor attack (Movistar) spiked Port-out queries by <strong>+4.9%</strong>.",

                acc1: { t: "01. Scale Engineering: BigQuery Optimization", d: "DDL with Partitioning and Clustering for cost efficiency on massive logs.", code_comm: "-- Partitioning and clustering optimization" },
                acc2: { t: "02. Prioritization Logic: Python Scoring", d: "Preventive scoring for critical base shielding (Score = Churn Prob * ARPU).", code_comm1: "# Calculate Risk Score", code_comm2: "# Benefit assignment logic" },
                acc3: { t: "03. Dashboarding: SQL for Looker Studio", d: "Queries connecting BigQuery to Looker Studio to automate crisis indicators.", h3a: "BQ SQL | Looker: Share Out", h3b: "BQ SQL | Looker: Network vs Lag Time", h3c: "BQ SQL | Looker: Retention ROI" },

                label4: "04. Results Visualization",
                contactText: "This case demonstrates the ability to handle sensitive business metrics and present them to C-Level executives.",
                contactBtn: "Contact Javier"
            }
        };

        function changeLang(lang) {
            document.querySelectorAll('.lang-btn').forEach(b => b.classList.remove('active'));
            document.getElementById('btn-' + lang).classList.add('active');
            
            const t = translations[lang];

            // Header
            document.getElementById('header-badge').textContent = t.badge;
            document.getElementById('header-title').innerHTML = t.h1;
            document.getElementById('header-subtitle').textContent = t.subtitle;
            document.getElementById('header-desc').textContent = t.desc;

            // Section 1
            document.getElementById('label-1').textContent = t.label1;
            document.getElementById('title-1').textContent = t.title1;
            document.getElementById('text-1').innerHTML = t.text1;

            // Section 2
            document.getElementById('label-2').textContent = t.label2;
            document.getElementById('title-2').textContent = t.title2;
            document.getElementById('step-raw-desc').textContent = t.steps.raw;
            document.getElementById('step-silver-desc').textContent = t.steps.silver;
            document.getElementById('step-gold-desc').textContent = t.steps.gold;
            document.getElementById('step-dash-desc').textContent = t.steps.dash;

            // Section 3
            document.getElementById('label-3').textContent = t.label3;
            document.getElementById('title-3').textContent = t.title3;
            document.getElementById('alert-text').innerHTML = t.alert;

            // Accordion Items
            document.getElementById('acc-title-1').textContent = t.acc1.t;
            document.getElementById('acc-desc-1').textContent = t.acc1.d;
            // Inject SQL Code translation (keeping structure)
            document.getElementById('code-1').innerHTML = `<span class="sql-comm">${t.acc1.code_comm}</span>
<span class="sql-kw">CREATE OR REPLACE TABLE</span> \`gold.falla_red_momento_cero\`
<span class="sql-kw">PARTITION BY</span> <span class="sql-func">DATE</span>(fecha_incidencia)
<span class="sql-kw">CLUSTER BY</span> customer_id <span class="sql-kw">AS</span>
<span class="sql-kw">WITH</span> RankedLogs <span class="sql-kw">AS</span> (
  <span class="sql-kw">SELECT</span> *, <span class="sql-func">ROW_NUMBER</span>() <span class="sql-kw">OVER</span>(<span class="sql-kw">PARTITION BY</span> customer_id <span class="sql-kw">ORDER BY</span> timestamp) <span class="sql-kw">AS</span> rank_e
  <span class="sql-kw">FROM</span> \`raw.network_logs\` <span class="sql-kw">WHERE</span> status = <span class="sql-str">'FAIL'</span>
)
<span class="sql-kw">SELECT</span> * <span class="sql-kw">FROM</span> RankedLogs <span class="sql-kw">WHERE</span> rank_e = <span class="sql-num">1</span>;`;

            document.getElementById('acc-title-2').textContent = t.acc2.t;
            document.getElementById('acc-desc-2').textContent = t.acc2.d;
            // Inject Python Code translation
            document.getElementById('code-2').innerHTML = `<span class="sql-kw">def</span> <span class="sql-func">asignar_blindaje</span>(df):
    <span class="sql-comm">${t.acc2.code_comm1}</span>
    df[<span class="sql-str">'score'</span>] = df[<span class="sql-str">'prob_fuga'</span>] * df[<span class="sql-str">'arpu'</span>]
    top_target = df.nlargest(<span class="sql-num">240000</span>, <span class="sql-str">'score'</span>)
    <span class="sql-comm">${t.acc2.code_comm2}</span>
    top_target[<span class="sql-str">'action'</span>] = top_target[<span class="sql-str">'is_legacy'</span>].apply(<span class="sql-kw">lambda</span> x: <span class="sql-str">'RECAMBIO'</span> <span class="sql-kw">if</span> x <span class="sql-kw">else</span> <span class="sql-str">'100GB'</span>)
    <span class="sql-kw">return</span> top_target`;

            document.getElementById('acc-title-3').textContent = t.acc3.t;
            document.getElementById('acc-desc-3').textContent = t.acc3.d;
            document.getElementById('code-h-3a').textContent = t.acc3.h3a;
            document.getElementById('code-h-3b').textContent = t.acc3.h3b;
            document.getElementById('code-h-3c').textContent = t.acc3.h3c;

            // Section 4
            document.getElementById('label-4').textContent = t.label4;

            // Contact
            document.getElementById('contact-text').textContent = t.contactText;
            document.getElementById('contact-btn-text').textContent = t.contactBtn;
        }

        // --- CHARTS CONFIG ---
        Highcharts.setOptions({
            chart: { backgroundColor: 'transparent', style: { fontFamily: 'Open Sans' } },
            title: { style: { color: '#ffffff', fontWeight: 'bold' } },
            xAxis: { labels: { style: { color: '#b0b0b0' } } },
            yAxis: { gridLineColor: '#333', labels: { style: { color: '#b0b0b0' } } },
            credits: { enabled: false }
        });

        Highcharts.chart('chart-competencia', {
            chart: { type: 'column' },
            title: { text: 'Evolución Share Out por Competidor' },
            xAxis: { categories: ['Ene', 'Feb', 'Mar', 'Abr', 'May (Crisis)'] },
            plotOptions: { column: { stacking: 'percent' } },
            series: [{ name: 'Movistar', data: [30, 32, 35, 38, 45], color: '#00C9FF' },
                     { name: 'Entel', data: [35, 34, 33, 32, 28], color: '#ff8c00' },
                     { name: 'WOM', data: [10, 10, 9, 8, 7], color: '#E6007E' }]
        });

        Highcharts.chart('chart-diagnostico', {
            title: { text: 'Incidentes Red vs Reacción Fuga' },
            xAxis: { categories: ['Sem 1', 'Sem 2 (Falla)', 'Sem 3', 'Sem 4'] },
            yAxis: [{ title: { text: 'Incidentes' } }, { title: { text: 'Lag Time (Días)' }, opposite: true }],
            series: [{ name: 'Incidentes', type: 'column', data: [1200, 4800, 1500, 900], color: '#00C9FF' },
                     { name: 'Lag Time', type: 'spline', yAxis: 1, data: [15, 3, 5, 12], color: '#E6007E' }]
        });

        Highcharts.chart('chart-respuesta', {
            title: { text: 'Efectividad Retención' },
            xAxis: { categories: ['Ene', 'Feb', 'Mar', 'Abr', 'May'] },
            series: [{ name: 'Retenidos', type: 'column', data: [18000, 19200, 18500, 19100, 23858], color: '#6a0dad' }]
        });
    </script>
    <script>
    document.addEventListener("DOMContentLoaded", function() {
        // 1. Capturar los parámetros con los que llegamos a esta página
        const params = new URLSearchParams(window.location.search);
        
        const mode = params.get('v');       // ej: global
        const country = params.get('pais'); // ej: cl
        const lang = params.get('lang');    // ej: es, en

        // 2. Referencia al botón de volver (asegúrate que tu <a> tenga id="btn-back")
        const backBtn = document.getElementById('btn-back');
        
        // Si no usaste ID, intentamos buscar cualquier link que vaya al index
        const fallbackBtn = document.querySelector('a[href*="index.html"]');
        const targetBtn = backBtn || fallbackBtn;

        if (targetBtn) {
            // 3. Construir la URL de regreso preservando el estado
            let returnUrl = "../index.html?";
            
            // Solo agregamos los parámetros si existen
            if (mode) returnUrl += `v=${mode}&`;
            if (country) returnUrl += `pais=${country}&`;
            
            // Para el idioma, usamos 'initialLang' para que el index lo fuerce al cargar
            if (lang) returnUrl += `initialLang=${lang}`;

            // 4. Asignar la nueva URL al botón
            targetBtn.href = returnUrl;
            
            console.log("Link de retorno configurado a:", returnUrl);
        }

        // OPCIONAL: Si quieres ocultar contenido en inglés/español dentro del caso
        // Puedes usar clases CSS como .lang-es o .lang-en
        if (lang === 'es') {
            document.body.classList.add('is-spanish');
        } else {
            document.body.classList.add('is-english');
        }
    });
</script>
</body>
</html>