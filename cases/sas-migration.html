<!DOCTYPE html>
<html lang="es" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Clínica Alemana | Migración SAS a BigQuery</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&family=JetBrains+Mono:wght@400&family=Montserrat:wght@400;700;800&display=swap" rel="stylesheet">
    
    <script src="https://unpkg.com/lucide@latest"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <script src="https://code.highcharts.com/highcharts.js"></script>
    <script src="https://code.highcharts.com/highcharts-more.js"></script>
    <script src="https://code.highcharts.com/modules/solid-gauge.js"></script>

    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                        mono: ['JetBrains Mono', 'monospace'],
                        header: ['Montserrat', 'sans-serif']
                    },
                    colors: {
                        aleBlue: '#004B87',
                        aleGreen: '#009A44',
                        aleLight: '#4FC3F7',
                        darkBg: '#020b14',
                        glassBorder: 'rgba(255, 255, 255, 0.1)',
                        jiraBlue: '#0052CC',
                        jiraBg: '#1C212A'
                    }
                }
            }
        }
    </script>

    <style>
        /* --- ESTILOS GENERALES Y FONDO --- */
        body { 
            background-color: #020b14; 
            background-image: radial-gradient(circle at 50% 0%, rgba(0, 75, 135, 0.15), transparent 70%);
            color: white;
            font-family: 'Inter', sans-serif;
            padding-top: 80px; /* Espacio para el navbar fijo */
        }
        
        /* Efecto Cristal */
        .glass { 
            background: rgba(255, 255, 255, 0.03); 
            backdrop-filter: blur(16px); 
            border: 1px solid var(--glassBorder); 
        }

        /* --- NAVBAR ESTILO WOM (ADAPTADO) --- */
        .nav-bar {
            padding: 10px 40px;
            display: flex; 
            justify-content: space-between; 
            align-items: center;
            border-bottom: 1px solid rgba(255,255,255,0.05);
            background: rgba(2, 11, 20, 0.90); 
            backdrop-filter: blur(10px);
            position: fixed; 
            width: 100%; 
            top: 0; 
            left: 0;
            z-index: 1000; 
            box-sizing: border-box;
        }
        
        .back-link {
            text-decoration: none; 
            color: #b0b0b0; 
            font-size: 0.9rem;
            display: flex; 
            align-items: center; 
            gap: 8px; 
            transition: 0.3s;
            font-weight: 500;
        }
        
        .back-link:hover { 
            color: #009A44; /* Alemana Green */
            transform: translateX(-5px); 
        }

        .nav-name {
            font-weight: 700; 
            color: white;
            font-family: 'Inter', sans-serif;
        }

        /* Contenedor de banderas centrado */
        .nav-lang-container {
            display: flex;
            gap: 10px;
        }

        .lang-btn {
            background: none; 
            border: 2px solid transparent; 
            border-radius: 50%; 
            cursor: pointer;
            padding: 0; 
            width: 30px; height: 30px;
            display: flex; align-items: center; justify-content: center;
            overflow: hidden;
            opacity: 0.5; 
            transition: 0.3s;
        }

        .lang-btn img { width: 100%; height: 100%; object-fit: cover; }
        .lang-btn:hover { opacity: 1; transform: scale(1.1); }
        .lang-btn.active { 
            opacity: 1; 
            border-color: #009A44; /* Alemana Green */
            box-shadow: 0 0 10px rgba(0, 154, 68, 0.4); 
            transform: scale(1.15); 
        }

        /* --- LOGO header --- */
        .brand-logo-header {
            max-width: 180px;
            height: auto;
            margin: 0 auto 30px auto;
            display: block;
            /* Efecto Neón adaptado a Alemana (Verde/Azul) */
            filter: drop-shadow(0 0 2px #009A44) 
                    drop-shadow(0 0 8px rgba(0, 75, 135, 0.5));
            opacity: 1;
            transition: transform 0.3s ease, filter 0.3s ease;
        }
        
        .brand-logo-header:hover {
            transform: scale(1.05);
            filter: drop-shadow(0 0 2px #009A44) 
                    drop-shadow(0 0 12px #009A44);
        }

        /* --- FOOTER BUTTON --- */
        .contact-btn {
            display: inline-block; 
            padding: 15px 30px; 
            background: #009A44; /* Alemana Green */
            color: white; 
            border-radius: 30px; 
            font-weight: 700; 
            text-decoration: none; 
            box-shadow: 0 10px 30px rgba(0, 154, 68, 0.3); 
            transition: 0.3s;
            font-family: 'Inter', sans-serif;
        }

        .contact-btn:hover {
            transform: translateY(-3px);
            background: #007a36;
            box-shadow: 0 15px 40px rgba(0, 154, 68, 0.5);
            color: white;
        }

        /* --- OTROS ESTILOS EXISTENTES --- */
        .text-gradient { 
            background: linear-gradient(90deg, #fff, #4FC3F7); 
            -webkit-background-clip: text; 
            -webkit-text-fill-color: transparent; 
        }

        .code-scroll::-webkit-scrollbar { height: 8px; }
        .code-scroll::-webkit-scrollbar-thumb { background: #333; rounded: 4px; }
        .code-scroll::-webkit-scrollbar-track { background: transparent; }

        .hover-card { transition: transform 0.3s ease, box-shadow 0.3s ease; }
        .hover-card:hover { transform: translateY(-5px); box-shadow: 0 10px 30px rgba(0, 154, 68, 0.1); }
        
        .highcharts-container { font-family: 'Inter', sans-serif !important; }
        
        .jira-badge { background: #dfe1e6; color: #172b4d; font-size: 10px; padding: 2px 6px; border-radius: 3px; font-weight: bold; text-transform: uppercase; }
        .jira-status { background: #00875A; color: white; font-size: 10px; padding: 2px 6px; border-radius: 3px; font-weight: bold; text-transform: uppercase; }

        @media (max-width: 768px) {
            .nav-name { display: none; }
            .nav-bar { padding: 10px 20px; }
        }
    </style>
</head>
<body class="antialiased pb-20">

    <nav class="nav-bar">
        <a href="../index.html#projects" class="back-link">
            <i class="fas fa-arrow-left"></i> 
            <span id="nav-back">Volver al Portafolio</span>
        </a>

        <div class="nav-lang-container">
            <button onclick="changeLang('en')" class="lang-btn" id="btn-en">
                <img src="https://flagcdn.com/w80/gb.png" alt="English">
            </button>
            <button onclick="changeLang('es')" class="lang-btn active" id="btn-es">
                <img src="https://flagcdn.com/w80/es.png" alt="Español">
            </button>
        </div>
        
        <div class="nav-name">Javier Moraga</div>
    </nav>

    <main class="container mx-auto px-4 sm:px-6 pt-10 max-w-6xl">
        
        <header class="text-center mb-16 relative">
            <img src="../logos/clinica_alemana_chile.png" alt="Clínica Alemana" class="brand-logo-header">

            <div class="inline-flex items-center gap-2 px-3 py-1 rounded-full bg-aleGreen/10 border border-aleGreen/30 text-aleGreen text-xs font-bold mb-6 tracking-widest uppercase animate-fade-in-up">
                <i data-lucide="file-code" class="w-3 h-3"></i>
                <span id="hero-badge">Ingeniería Inversa & Gobernanza</span>
            </div>
            
            <h1 class="text-4xl md:text-6xl lg:text-7xl font-bold mb-6 leading-tight tracking-tight font-header">
                <span id="main-title-1">Modernización de</span> <br>
                <span class="text-gradient" id="main-title-2">Procesos Clínicos SAS</span>
            </h1>
            
            <p class="max-w-2xl mx-auto text-gray-400 text-lg leading-relaxed" id="main-desc">
                Transformación de lógica legacy indocumentada ("Caja Negra") hacia un ecosistema gobernado en Google BigQuery. Análisis de rentabilidad y documentación técnica exhaustiva.
            </p>
        </header>

        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-20">
            <div class="glass p-8 rounded-3xl relative overflow-hidden group hover-card">
                <div class="absolute top-0 right-0 p-6 opacity-10 group-hover:opacity-100 transition duration-500">
                    <i data-lucide="search" class="w-16 h-16 text-aleGreen"></i>
                </div>
                <h3 class="text-gray-400 text-xs font-bold uppercase tracking-widest mb-2" id="card-1-title">Visibilidad</h3>
                <div class="flex items-baseline gap-2">
                    <span class="text-5xl font-bold text-white tracking-tighter">100%</span>
                </div>
                <div class="mt-4 pt-4 border-t border-white/5">
                    <p class="text-xs text-gray-500 font-mono" id="card-1-desc">De código SAS oscuro a documentación JIRA</p>
                </div>
            </div>
            
            <div class="glass p-8 rounded-3xl relative overflow-hidden group hover-card">
                <div class="absolute top-0 right-0 p-6 opacity-10 group-hover:opacity-100 transition duration-500">
                    <i data-lucide="shield-check" class="w-16 h-16 text-aleLight"></i>
                </div>
                <h3 class="text-gray-400 text-xs font-bold uppercase tracking-widest mb-2" id="card-2-title">Gobernanza</h3>
                <div class="flex flex-col gap-2 mt-2">
                    <div class="flex gap-2">
                        <span class="text-[10px] px-2 py-1 rounded bg-red-500/10 text-red-400 border border-red-500/20 font-mono">dg-has-pii: yes</span>
                        <span class="text-[10px] px-2 py-1 rounded bg-aleBlue/20 text-aleBlue border border-aleBlue/30 font-mono">class: sensitive</span>
                    </div>
                    <span class="text-2xl font-bold text-white mt-1" id="card-2-stat">Etiquetado DDL</span>
                </div>
                <div class="mt-4 pt-4 border-t border-white/5">
                    <p class="text-xs text-gray-500 font-mono" id="card-2-desc">Cumplimiento normativa datos médicos</p>
                </div>
            </div>

            <div class="glass p-8 rounded-3xl relative overflow-hidden group hover-card">
                <div class="absolute top-0 right-0 p-6 opacity-10 group-hover:opacity-100 transition duration-500">
                    <i data-lucide="coins" class="w-16 h-16 text-white"></i>
                </div>
                <h3 class="text-gray-400 text-xs font-bold uppercase tracking-widest mb-2" id="card-3-title">Eficiencia</h3>
                <div class="flex items-baseline gap-2">
                    <span class="text-5xl font-bold text-white tracking-tighter">5x</span>
                    <span class="text-aleLight font-bold text-lg">ROI</span>
                </div>
                <div class="mt-4 pt-4 border-t border-white/5">
                    <p class="text-xs text-gray-500 font-mono" id="card-3-desc">Eliminación licencias SAS on-premise</p>
                </div>
            </div>
        </div>

        <section class="mb-24">
            <div class="glass rounded-3xl p-8 md:p-12">
                <h2 class="text-2xl font-bold mb-10 flex items-center gap-3 font-header" id="cycle-title">
                    <i data-lucide="workflow" class="text-aleGreen"></i>
                    Ciclo de Modernización
                </h2>
                
                <div class="grid grid-cols-1 md:grid-cols-4 gap-4 relative">
                    <div class="p-6 rounded-2xl bg-white/5 border border-white/5 relative group">
                        <div class="absolute -top-3 -left-3 w-8 h-8 rounded-full bg-gray-700 flex items-center justify-center font-bold text-sm">1</div>
                        <h4 class="font-bold text-gray-300 mb-2">Discovery</h4>
                        <p class="text-xs text-gray-500" id="cycle-1-desc">Análisis de rentabilidad y estudio de scripts SAS "Legacy" sin documentación (PIDs, Macros).</p>
                    </div>

                    <div class="p-6 rounded-2xl bg-white/5 border border-white/5 relative group">
                        <div class="absolute -top-3 -left-3 w-8 h-8 rounded-full bg-aleBlue flex items-center justify-center font-bold text-sm">2</div>
                        <h4 class="font-bold text-gray-300 mb-2">Engineering</h4>
                        <p class="text-xs text-gray-500" id="cycle-2-desc">Adaptación a BigQuery. Eliminación de loops iterativos (SAS Instan1-5) por lógica de conjuntos.</p>
                    </div>

                    <div class="p-6 rounded-2xl bg-aleGreen/10 border border-aleGreen/30 relative group shadow-[0_0_15px_rgba(0,154,68,0.1)]">
                        <div class="absolute -top-3 -left-3 w-8 h-8 rounded-full bg-aleGreen flex items-center justify-center font-bold text-sm">3</div>
                        <h4 class="font-bold text-white mb-2">Governance</h4>
                        <p class="text-xs text-gray-400" id="cycle-3-desc">Aplicación de Tags (PII/Sensible) y linaje de datos en la definición de tablas (DDL).</p>
                    </div>

                    <div class="p-6 rounded-2xl bg-jiraBlue/10 border border-jiraBlue/30 relative group">
                        <div class="absolute -top-3 -left-3 w-8 h-8 rounded-full bg-jiraBlue flex items-center justify-center font-bold text-sm">4</div>
                        <h4 class="font-bold text-white mb-2">Handover</h4>
                        <p class="text-xs text-gray-400" id="cycle-4-desc">Documentación técnica en JIRA, cierre de ticket y entrega a negocio.</p>
                    </div>
                </div>
            </div>
        </section>

        <section class="mb-24">
            <div class="flex flex-col md:flex-row justify-between items-end mb-8">
                <div>
                    <span class="text-aleGreen font-bold text-xs uppercase tracking-widest" id="code-subtitle">Del Caos al Orden</span>
                    <h2 class="text-3xl font-bold mt-2 font-header" id="code-title">Refactorización de Lógica</h2>
                </div>
                <div class="flex gap-4 mt-4 md:mt-0">
                    <div class="flex items-center gap-2 text-xs text-gray-500">
                        <div class="w-3 h-3 bg-red-500/50 rounded-full"></div> Legacy SAS
                    </div>
                    <div class="flex items-center gap-2 text-xs text-gray-500">
                        <div class="w-3 h-3 bg-aleGreen rounded-full"></div> BigQuery Gov
                    </div>
                </div>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <div class="rounded-xl overflow-hidden border border-white/10 bg-[#0d1117] shadow-2xl flex flex-col h-full">
                    <div class="bg-[#161b22] px-4 py-3 border-b border-white/5 flex items-center justify-between">
                        <span class="text-xs font-mono text-gray-500">RedcapKineDrenaje.sas</span>
                        <span class="text-[10px] text-red-400 border border-red-500/20 bg-red-500/10 px-2 py-0.5 rounded" id="label-manual">Iterativo Manual</span>
                    </div>
                    <div class="p-6 overflow-x-auto code-scroll flex-1 relative">
                        <div class="absolute top-16 left-0 w-full h-24 bg-red-500/5 pointer-events-none border-l-2 border-red-500/50"></div>
                        <pre class="font-mono text-xs leading-relaxed text-gray-300"><code><span class="text-gray-500">/* PROCESO MANUAL: Repite 5 veces para transponer */</span>
<span class="text-blue-400">PROC SQL</span>;
<span class="text-purple-400">CREATE TABLE</span> WORK.INSTAN1 <span class="text-purple-400">AS SELECT</span> 
    t1.record, 
    (<span class="text-yellow-300">MIN</span>(t1.valor)) <span class="text-purple-400">AS</span> valor, 
    (1) <span class="text-purple-400">AS</span> instance
<span class="text-purple-400">FROM</span> WORK.REDCAP_DATA5 t1
<span class="text-purple-400">GROUP BY</span> t1.record;
<span class="text-blue-400">QUIT</span>;

<span class="text-gray-500">/* ... Código repetido para INSTAN2, INSTAN3... INSTAN5 ... */</span>
<span class="text-blue-400">PROC SQL</span>; 
  <span class="text-purple-400">CREATE TABLE</span> WORK.NOTIF <span class="text-purple-400">AS</span> 
  <span class="text-purple-400">SELECT</span> * <span class="text-purple-400">FROM</span> INSTAN1 <span class="text-purple-400">UNION</span> ...
<span class="text-blue-400">QUIT</span>;</code></pre>
                    </div>
                </div>

                <div class="rounded-xl overflow-hidden border border-aleGreen/30 bg-[#0d1117] shadow-[0_0_40px_rgba(0,154,68,0.05)] flex flex-col h-full">
                    <div class="bg-[#161b22] px-4 py-3 border-b border-white/5 flex items-center justify-between">
                        <span class="text-xs font-mono text-aleGreen">tabla_final_kine.sql</span>
                        <span class="text-[10px] text-aleGreen border border-aleGreen/20 bg-aleGreen/10 px-2 py-0.5 rounded" id="label-gov">Gobernado</span>
                    </div>
                    <div class="p-6 overflow-x-auto code-scroll flex-1">
                        <pre class="font-mono text-xs leading-relaxed text-gray-300"><code><span class="text-blue-400">CREATE OR REPLACE TABLE</span> `ds_cns.kine_drenaje`
<span class="text-blue-400">PARTITION BY</span> DATE(fecha_hr)
<span class="text-blue-400">CLUSTER BY</span> record, rut
<span class="text-blue-400">OPTIONS</span>(
  description = <span class="text-green-400">"Consolidado Kinesiología"</span>,
  <span class="text-gray-500">-- Etiquetado de Gobernanza en DDL --</span>
  labels = [
    (<span class="text-green-400">'dg-source'</span>, <span class="text-green-400">'redcap'</span>),
    (<span class="text-green-400">'dg-has-pii'</span>, <span class="text-green-400">'si'</span>),
    (<span class="text-green-400">'dg-data-classification'</span>, <span class="text-green-400">'altamente_sensible'</span>)
  ]
) <span class="text-blue-400">AS SELECT</span>
  record_id,
  <span class="text-gray-500">-- Normalización de Identidad --</span>
  <span class="text-yellow-300">UPPER</span>(<span class="text-yellow-300">COALESCE</span>(pasaporte, rut)) <span class="text-purple-400">AS</span> rut_std,
  evaluacion_drenaje_linfaticoonco
<span class="text-purple-400">FROM</span> `ds_trf.transposed_data_1142`;</code></pre>
                    </div>
                </div>
            </div>
        </section>

        <section class="mb-24">
            <h2 class="text-lg font-bold mb-6 flex items-center gap-2 font-header" id="jira-title">
                <i class="fab fa-jira text-jiraBlue"></i>
                Gestión y Documentación (JIRA)
            </h2>
            
            <div class="bg-jiraBg border border-white/10 rounded-lg p-6 max-w-4xl mx-auto shadow-lg relative overflow-hidden">
                <div class="flex justify-between items-start mb-6 border-b border-white/5 pb-4">
                    <div>
                        <div class="flex items-center gap-2 mb-2">
                            <span class="text-jiraBlue font-bold text-sm">DATA-1142</span>
                            <span class="text-gray-400 text-sm">/ Migración RedCap Kine</span>
                        </div>
                        <h3 class="text-xl font-semibold text-white" id="jira-task">Disponibilización Dataset "Kinesiología y Drenaje Linfático"</h3>
                    </div>
                    <div class="flex flex-col items-end gap-2">
                        <span class="jira-status">DONE</span>
                        <div class="flex items-center gap-2">
                            <div class="w-6 h-6 rounded-full bg-aleGreen flex items-center justify-center text-[10px] font-bold">JM</div>
                            <span class="text-xs text-gray-400">Javier Moraga</span>
                        </div>
                    </div>
                </div>

                <div class="pl-0 md:pl-10 relative">
                    <div class="absolute left-2 top-0 bottom-0 w-0.5 bg-white/10 hidden md:block"></div>
                    <div class="mb-4">
                        <p class="text-gray-300 text-sm mb-4" id="jira-desc">
                            Se ha completado el desarrollo de la ingeniería de datos necesaria para alimentar el Dashboard. El proceso extrae y estructura la información desde la fuente transpuesta de REDCap.
                        </p>
                        
                        <div class="bg-black/30 p-4 rounded border border-white/5 mb-4">
                            <h5 class="text-xs font-bold text-aleLight uppercase mb-2" id="jira-summary">Resumen de Implementación</h5>
                            <ul class="list-disc list-inside text-xs text-gray-400 space-y-1">
                                <li><span class="text-white" id="jira-point-1">Transformación:</span> <span id="jira-text-1">Normalización de RUT/Pasaporte mediante lógica COALESCE.</span></li>
                                <li><span class="text-white" id="jira-point-2">Limpieza:</span> <span id="jira-text-2">Selección de 41 campos clínicos (Escalas PCAIDA, Antropometría).</span></li>
                                <li><span class="text-white" id="jira-point-3">Gobernanza:</span> <span id="jira-text-3">Dataset marcado como <code class="bg-red-500/20 text-red-300 px-1 rounded">altamente_sensible</code>.</span></li>
                            </ul>
                        </div>

                        <p class="text-xs text-gray-500 mt-2">
                            <strong id="jira-deliverable">Entregable:</strong> <code>datalake-base-prd.ds_cns.redcap_1142_kine</code><br>
                            <span id="jira-footer">El dataset está listo para consumo en capa CNS. Se recomienda filtrar por <code>fecha_hr_registro</code>.</span>
                        </p>
                    </div>
                </div>
            </div>
        </section>

        <section class="grid grid-cols-1 md:grid-cols-2 gap-8 mb-24">
            <div class="glass p-8 rounded-3xl">
                <h3 class="text-lg font-bold mb-6 flex items-center gap-2 font-header" id="chart-1-title">
                    <i data-lucide="bar-chart-2" class="w-5 h-5 text-aleGreen"></i>
                    Optimización de Rendimiento
                </h3>
                <div id="chart-etl" style="height: 300px;"></div>
            </div>
            <div class="glass p-8 rounded-3xl">
                <h3 class="text-lg font-bold mb-6 flex items-center gap-2 font-header" id="chart-2-title">
                    <i data-lucide="database" class="w-5 h-5 text-aleLight"></i>
                    Volumetría de Datos
                </h3>
                <div id="chart-volume" style="height: 300px;"></div>
            </div>
        </section>

        <div class="text-center border-t border-white/5 pt-12 pb-12 mt-12">
            <p class="text-gray-500 text-sm mb-8 max-w-xl mx-auto" id="contact-text">
                Este proyecto demuestra capacidad técnica para transformar deuda tecnológica en activos de datos gobernados y rentables.
            </p>
            <a href="../index.html#contact" class="contact-btn">
                <span id="contact-btn-text">Contactar a Javier</span>
            </a>
        </div>

    </main>

    <script>
        // Init Icons
        lucide.createIcons();

        // --- SISTEMA DE TRADUCCIÓN ---
        const translations = {
            es: {
                navBack: "Volver al Portafolio",
                badge: "Ingeniería Inversa & Gobernanza",
                mainTitle1: "Modernización de",
                mainTitle2: "Procesos Clínicos SAS",
                desc: 'Transformación de lógica legacy indocumentada ("Caja Negra") hacia un ecosistema gobernado en Google BigQuery. Análisis de rentabilidad y documentación técnica exhaustiva.',
                
                // Cards
                card1Title: "Visibilidad",
                card1Desc: "De código SAS oscuro a documentación JIRA",
                card2Title: "Gobernanza",
                card2Stat: "Etiquetado DDL",
                card2Desc: "Cumplimiento normativa datos médicos",
                card3Title: "Eficiencia",
                card3Desc: "Eliminación licencias SAS on-premise",

                // Ciclo
                cycleTitle: "Ciclo de Modernización",
                cycle1Desc: 'Análisis de rentabilidad y estudio de scripts SAS "Legacy" sin documentación (PIDs, Macros).',
                cycle2Desc: "Adaptación a BigQuery. Eliminación de loops iterativos (SAS Instan1-5) por lógica de conjuntos.",
                cycle3Desc: "Aplicación de Tags (PII/Sensible) y linaje de datos en la definición de tablas (DDL).",
                cycle4Desc: "Documentación técnica en JIRA, cierre de ticket y entrega a negocio.",

                // Código
                codeSubtitle: "Del Caos al Orden",
                codeTitle: "Refactorización de Lógica",
                labelManual: "Iterativo Manual",
                labelGov: "Gobernado",

                // Jira
                jiraTitle: "Gestión y Documentación (JIRA)",
                jiraTask: 'Disponibilización Dataset "Kinesiología y Drenaje Linfático"',
                jiraDesc: "Se ha completado el desarrollo de la ingeniería de datos necesaria para alimentar el Dashboard. El proceso extrae y estructura la información desde la fuente transpuesta de REDCap.",
                jiraSummary: "Resumen de Implementación",
                jiraPoint1: "Transformación:",
                jiraText1: "Normalización de RUT/Pasaporte mediante lógica COALESCE.",
                jiraPoint2: "Limpieza:",
                jiraText2: "Selección de 41 campos clínicos (Escalas PCAIDA, Antropometría).",
                jiraPoint3: "Gobernanza:",
                jiraText3: 'Dataset marcado como <code class="bg-red-500/20 text-red-300 px-1 rounded">altamente_sensible</code>.',
                jiraDeliverable: "Entregable:",
                jiraFooter: "El dataset está listo para consumo en capa CNS. Se recomienda filtrar por <code>fecha_hr_registro</code>.",

                // Charts
                chart1Title: "Optimización de Rendimiento",
                chartSeries1: "Minutos de Proceso",
                chart2Title: "Volumetría de Datos",
                chartSeries2: "Datos Procesados (GB)",

                // Footer
                contactText: "Este proyecto demuestra capacidad técnica para transformar deuda tecnológica en activos de datos gobernados y rentables.",
                contactBtn: "Contactar a Javier"
            },
            en: {
                navBack: "Back to Portfolio",
                badge: "Reverse Engineering & Governance",
                mainTitle1: "Modernization of",
                mainTitle2: "SAS Clinical Processes",
                desc: 'Transformation of undocumented legacy logic ("Black Box") into a governed Google BigQuery ecosystem. Profitability analysis and comprehensive technical documentation.',
                
                // Cards
                card1Title: "Visibility",
                card1Desc: "From obscure SAS code to JIRA documentation",
                card2Title: "Governance",
                card2Stat: "DDL Tagging",
                card2Desc: "Medical data compliance",
                card3Title: "Efficiency",
                card3Desc: "Elimination of on-premise SAS licenses",

                // Cycle
                cycleTitle: "Modernization Cycle",
                cycle1Desc: 'Profitability analysis and study of undocumented "Legacy" SAS scripts (PIDs, Macros).',
                cycle2Desc: "Adaptation to BigQuery. Elimination of iterative loops (SAS Instan1-5) using set logic.",
                cycle3Desc: "Application of Tags (PII/Sensitive) and data lineage in table definitions (DDL).",
                cycle4Desc: "Technical documentation in JIRA, ticket closure, and handover to business.",

                // Code
                codeSubtitle: "From Chaos to Order",
                codeTitle: "Logic Refactoring",
                labelManual: "Manual Iterative",
                labelGov: "Governed",

                // Jira
                jiraTitle: "Management & Documentation (JIRA)",
                jiraTask: 'Dataset Availability "Kinesiology and Lymphatic Drainage"',
                jiraDesc: "Data engineering development to feed the Dashboard is complete. The process extracts and structures information from the transposed REDCap source.",
                jiraSummary: "Implementation Summary",
                jiraPoint1: "Transformation:",
                jiraText1: "Normalization of National ID/Passport using COALESCE logic.",
                jiraPoint2: "Cleaning:",
                jiraText2: "Selection of 41 clinical fields (PCAIDA Scales, Anthropometry).",
                jiraPoint3: "Governance:",
                jiraText3: 'Dataset flagged as <code class="bg-red-500/20 text-red-300 px-1 rounded">highly_sensitive</code>.',
                jiraDeliverable: "Deliverable:",
                jiraFooter: "The dataset is ready for consumption in the CNS layer. Filtering by <code>fecha_hr_registro</code> is recommended.",

                // Charts
                chart1Title: "Performance Optimization",
                chartSeries1: "Process Minutes",
                chart2Title: "Data Volumetry",
                chartSeries2: "Processed Data (GB)",

                // Footer
                contactText: "This project demonstrates the technical ability to transform technical debt into governed and profitable data assets.",
                contactBtn: "Contact Javier"
            }
        };

        let chart1, chart2;

        function changeLang(lang) {
            // Activar botones (Estilo WOM)
            const btnEn = document.getElementById('btn-en');
            const btnEs = document.getElementById('btn-es');
            
            if(lang === 'en') {
                btnEn.classList.add('active');
                btnEs.classList.remove('active');
            } else {
                btnEs.classList.add('active');
                btnEn.classList.remove('active');
            }

            const t = translations[lang];

            // Navbar
            document.getElementById('nav-back').textContent = t.navBack;

            // Hero
            document.getElementById('hero-badge').innerText = t.badge;
            document.getElementById('main-title-1').innerText = t.mainTitle1;
            document.getElementById('main-title-2').innerText = t.mainTitle2;
            document.getElementById('main-desc').innerText = t.desc;

            // Cards
            document.getElementById('card-1-title').innerText = t.card1Title;
            document.getElementById('card-1-desc').innerText = t.card1Desc;
            document.getElementById('card-2-title').innerText = t.card2Title;
            document.getElementById('card-2-stat').innerText = t.card2Stat;
            document.getElementById('card-2-desc').innerText = t.card2Desc;
            document.getElementById('card-3-title').innerText = t.card3Title;
            document.getElementById('card-3-desc').innerText = t.card3Desc;

            // Cycle
            document.getElementById('cycle-title').innerHTML = `<i data-lucide="workflow" class="text-aleGreen"></i> ${t.cycleTitle}`;
            document.getElementById('cycle-1-desc').innerText = t.cycle1Desc;
            document.getElementById('cycle-2-desc').innerText = t.cycle2Desc;
            document.getElementById('cycle-3-desc').innerText = t.cycle3Desc;
            document.getElementById('cycle-4-desc').innerText = t.cycle4Desc;
            lucide.createIcons(); // Re-render icon

            // Code
            document.getElementById('code-subtitle').innerText = t.codeSubtitle;
            document.getElementById('code-title').innerText = t.codeTitle;
            document.getElementById('label-manual').innerText = t.labelManual;
            document.getElementById('label-gov').innerText = t.labelGov;

            // Jira
            document.getElementById('jira-title').innerHTML = `<i class="fab fa-jira text-jiraBlue"></i> ${t.jiraTitle}`;
            document.getElementById('jira-task').innerText = t.jiraTask;
            document.getElementById('jira-desc').innerText = t.jiraDesc;
            document.getElementById('jira-summary').innerText = t.jiraSummary;
            document.getElementById('jira-point-1').innerText = t.jiraPoint1;
            document.getElementById('jira-text-1').innerText = t.jiraText1;
            document.getElementById('jira-point-2').innerText = t.jiraPoint2;
            document.getElementById('jira-text-2').innerText = t.jiraText2;
            document.getElementById('jira-point-3').innerText = t.jiraPoint3;
            document.getElementById('jira-text-3').innerHTML = t.jiraText3;
            document.getElementById('jira-deliverable').innerText = t.jiraDeliverable;
            document.getElementById('jira-footer').innerHTML = t.jiraFooter;

            // Charts Headers
            document.getElementById('chart-1-title').innerHTML = `<i data-lucide="bar-chart-2" class="w-5 h-5 text-aleGreen"></i> ${t.chart1Title}`;
            document.getElementById('chart-2-title').innerHTML = `<i data-lucide="database" class="w-5 h-5 text-aleLight"></i> ${t.chart2Title}`;
            lucide.createIcons();

            // Footer
            document.getElementById('contact-text').innerText = t.contactText;
            document.getElementById('contact-btn-text').innerText = t.contactBtn;

            // Actualizar gráficas
            if(chart1) chart1.series[0].update({ name: t.chartSeries1 });
            if(chart2) chart2.series[0].update({ name: t.chartSeries2 });
        }

        // Charts Config
        Highcharts.setOptions({
            chart: { backgroundColor: 'transparent', style: { fontFamily: 'Inter' } },
            title: { text: null },
            credits: { enabled: false },
            colors: ['#004B87', '#009A44'],
            xAxis: { labels: { style: { color: '#9ca3af' } }, lineColor: 'rgba(255,255,255,0.1)' },
            yAxis: { title: { text: null }, labels: { style: { color: '#9ca3af' } }, gridLineColor: 'rgba(255,255,255,0.05)' },
            legend: { itemStyle: { color: '#d1d5db' } }
        });

        // Render Charts
        document.addEventListener('DOMContentLoaded', function () {
            chart1 = Highcharts.chart('chart-etl', {
                chart: { type: 'column' },
                xAxis: { categories: ['Legacy SAS', 'BigQuery'] },
                series: [{ 
                    name: 'Minutos de Proceso', 
                    data: [{y: 360, color: '#ef4444'}, {y: 15, color: '#009A44'}],
                    borderRadius: 4
                }]
            });

            chart2 = Highcharts.chart('chart-volume', {
                chart: { type: 'area' },
                xAxis: { categories: ['2023 Q1', '2023 Q2', '2023 Q3', '2023 Q4'] },
                series: [{ 
                    name: 'Datos Procesados (GB)', 
                    data: [12, 18, 45, 62], 
                    color: '#4FC3F7',
                    fillColor: { linearGradient: { x1: 0, y1: 0, x2: 0, y2: 1 }, stops: [[0, 'rgba(79, 195, 247, 0.2)'], [1, 'rgba(79, 195, 247, 0)']] }
                }]
            });
        });
    </script>
<script>
    document.addEventListener("DOMContentLoaded", function() {
        // 1. LEER PARÁMETROS DE LA URL
        const params = new URLSearchParams(window.location.search);
        
        const mode = params.get('v');       // global
        const country = params.get('pais'); // cl
        const lang = params.get('lang') || 'en'; // es / en

        // 2. APLICAR TRADUCCIÓN INMEDIATA
        // Si la URL dice ?lang=es, cambiamos los textos ahora mismo
        if (typeof changeLang === 'function') {
            changeLang(lang);
        }

        // 3. CONFIGURAR EL BOTÓN VOLVER
        // Buscamos por clase .back-link (ya que no tienes id="btn-back")
        const backBtn = document.querySelector('.back-link');

        if (backBtn) {
            let returnUrl = "../index.html";
            let returnParams = [];

            // Reconstruimos los parámetros para no perder el modo (Chile/Global)
            if (mode) returnParams.push(`v=${mode}`);
            if (country) returnParams.push(`pais=${country}`);
            
            // Pasamos el idioma de vuelta al index
            if (lang) returnParams.push(`lang=${lang}`);

            // Si hay parámetros, los agregamos
            if (returnParams.length > 0) {
                returnUrl += "?" + returnParams.join("&");
            }
            
            // Agregamos el ancla para volver directo a la sección de proyectos
            returnUrl += "#projects";

            backBtn.href = returnUrl;
        }
    });
</script>
</body>
</html>